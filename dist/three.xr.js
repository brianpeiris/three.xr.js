!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.WebXRUtils=e.WebXRManager=void 0;var i=n(1),a=r(i),o=n(2),s=r(o);n(3),e.WebXRManager=a.default,e.WebXRUtils=s.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),THREE.WebXRManager=function(){function t(t){this.sessionActive&&this.session.requestFrame(u);var e=t.getDisplayPose(t.getCoordinateSystem(XRCoordinateSystem.HEAD_MODEL));0===e._orientation[0]&&0===e._orientation[1]&&0===e._orientation[2]&&1===e._orientation[3]?this.poseFound&&(this.dispatchEvent({type:"poseLost"}),this.poseFound=!1):this.poseFound||(this.dispatchEvent({type:"poseFound"}),this.poseFound=!0),this.updateScene(o,t),this.renderer.autoClear=!1,this.renderer.setSize(this.session.baseLayer.framebufferWidth,this.session.baseLayer.framebufferHeight,!1),this.renderer.clear();var n=void 0;if(n=this.camera.parent&&"Scene"!==this.camera.parent.type?this.camera.parent:this.camera,n.matrixAutoUpdate=!1,n.matrix.fromArray(e.poseModelMatrix),n.matrix.decompose(n.position,n.quaternion,n.scale),n.updateMatrixWorld(!0),this.sessionActive)for(var r=0;r<t.views.length;r++){var i=t.views[r];this.camera.matrixWorldInverse.fromArray(i.viewMatrix),this.camera.projectionMatrix.fromArray(i.projectionMatrix),this.renderer.clearDepth();var a=i.getViewport(this.session.baseLayer);this.renderer.setViewport(a.x,a.y,a.width,a.height),this.doRender()}else this.renderer.clearDepth(),this.renderer.setViewport(0,0,window.innerWidth,window.innerHeight),this.doRender()}var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=arguments[2],i=arguments[3],a=arguments[4],o=arguments[5],s={AR_AUTOSTART:!0};this.options=Object.assign({},s,e),this.displays=n,this.renderer=r,this.camera=i,this.scene=a;var u=t.bind(this);this.sessions=[],this.session=null,this.autoStarted=!1,this.matrixWorldInverse=new THREE.Matrix4,this.poseFound=!1,this.startSession=function(t,e,n){var i=this,a=!1;"vr"===e&&(a=!0);var o={exclusive:a,type:a?XRSession.REALITY:XRSession.AUGMENTATION};if(!this.sessionActive){null!==this.session&&(this.session.end(),this.session=null);var s=this;t.requestSession(o).then(function(t){i.session=t,t.realityType=e,t.depthNear=.05,t.depthFar=1e3,t.addEventListener("focus",function(t){i.handleSessionFocus(t)}),t.addEventListener("blur",function(t){i.handleSessionBlur(t)}),t.addEventListener("end",function(t){i.handleSessionEnded(t)}),r.domElement.style.width="100%",r.domElement.style.height="100%","ar"===e&&n&&s.startPresenting()}).catch(function(t){console.error("Error requesting session",t)})}},this.startPresenting=function(){var t=this;c&&c._vrDisplay?(r.vr.enabled=!0,c._vrDisplay.isPresenting?c._vrDisplay.exitPresent():c._vrDisplay.requestPresent([{source:this.renderer.domElement}])):(this.session.baseLayer=new XRWebGLLayer(this.session,r.context),this.session.baseLayer.addEventListener("focus",function(e){t.handleLayerFocus(e)}),this.session.baseLayer.addEventListener("blur",function(e){t.handleLayerBlur(e)}),this.session.requestFrame(u),this.sessions.push(this.session),this.sessionActive=!0),this.dispatchEvent({type:"sessionStarted",session:this.session})},this.endSession=function(){this.session.end(),this.dispatchEvent({type:"sessionEnded",session:this.session}),this.sessionActive=!1,this.session._display._vrDisplay&&this.session._display.isPresenting&&(r.vr.enabled=!1,this.session._display._vrDisplay.exitPresent())},this.handleSessionFocus=function(t){console.log("handleSessionFocus")},this.handleSessionBlur=function(t){console.log("handleSessionBlur")},this.handleSessionEnded=function(t){console.log("handleSessionEnded")},this.handleLayerFocus=function(t){console.log("handleLayerFocus")},this.handleLayerBlur=function(t){console.log("handleLayerBlur")};var l,c,h=0,f=0;this.totalSupportedDisplays=0;for(var d=0;d<this.displays.length;d++){var _=this.displays[d];_.supportedRealities.vr&&(c=_,this.renderer.vr.setDevice(c._vrDisplay),h++),_.supportedRealities.ar&&(l=_,f++)}1===f&&0===h&&this.options.AR_AUTOSTART&&(this.autoStarted=!0,this.startSession(l,"ar",!0)),0===f&&1===h&&this.startSession(c,"vr",!1),this.totalSupportedDisplays=f+h,this.updateScene=function(t,e){t(e)},this.doRender=function(){this.renderer.render(this.scene,this.camera)}},THREE.WebXRManager.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.WebXRManager.prototype.constructor=THREE.WebXRManager,e.default=THREE.WebXRManager},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),THREE.WebXRUtils={getDisplays:function(){return new Promise(function(t,e){navigator.XR?navigator.XR.getDisplays().then(function(e){function n(){return void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")}if(0===e.length)return console.log("No displays are available"),void t(null);var r={exclusive:!1,type:XRSession.AUGMENTATION},i={exclusive:!0,type:XRSession.REALITY},a={vr:!1,ar:!1},o=!0,s=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(o=(l=c.next()).done);o=!0){var h=l.value;a={vr:!1,ar:!1},h.supportsSession(r)&&((h._reality._vrDisplay||!n()||function(){return-1!==navigator.userAgent.indexOf("AppleWebKit")&&-1===navigator.userAgent.indexOf("Safari")}())&&n()?a.ar=!0:a.ar=!1),h.supportsSession(i)&&-1===h._displayName.indexOf("polyfill")&&(a.vr=!0),h.supportedRealities=a}}catch(t){s=!0,u=t}finally{try{!o&&c.return&&c.return()}finally{if(s)throw u}}t(e)}).catch(function(e){console.error("Error getting XR displays",e),t(null)}):(console.log("WebXR polyfill is not found"),t(null))})}},e.default=THREE.WebXRUtils},function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=18)}([function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(1),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(){r(this,t)}return i(t,null,[{key:"mat4_generateIdentity",value:function(){return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},{key:"mat4_get_position",value:function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}},{key:"mat4_get_rotation",value:function(t,e){var n=new o.default;return n.setFromRotationMatrix(e),t[0]=n.x,t[1]=n.y,t[2]=n.z,t[3]=n.w,t}},{key:"mat4_eyeView",value:function(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array([0,0,0]);t.mat4_translate(e,n,r),t.mat4_invert(e,e)}},{key:"mat4_perspectiveFromFieldOfView",value:function(e,n,r,i){var a=Math.tan(n.upDegrees*t.PI_OVER_180),o=Math.tan(n.downDegrees*t.PI_OVER_180),s=Math.tan(n.leftDegrees*t.PI_OVER_180),u=Math.tan(n.rightDegrees*t.PI_OVER_180),l=2/(s+u),c=2/(a+o);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(s-u)*l*.5,e[9]=(a-o)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}},{key:"mat4_fromRotationTranslation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0],r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,d=i*u,_=i*l,v=a*l,p=o*s,y=o*u,m=o*l;return t[0]=1-(d+v),t[1]=h+m,t[2]=f-y,t[3]=0,t[4]=h-m,t[5]=1-(c+v),t[6]=_+p,t[7]=0,t[8]=f+y,t[9]=_-p,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}},{key:"mat4_translate",value:function(t,e,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],u=e[2],l=e[3],c=e[4],h=e[5],f=e[6],d=e[7],_=e[8],v=e[9],p=e[10],y=e[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=c,t[5]=h,t[6]=f,t[7]=d,t[8]=_,t[9]=v,t[10]=p,t[11]=y,t[12]=o*r+c*i+_*a+e[12],t[13]=s*r+h*i+v*a+e[13],t[14]=u*r+f*i+p*a+e[14],t[15]=l*r+d*i+y*a+e[15]),t}},{key:"mat4_invert",value:function(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],p=e[14],y=e[15],m=n*s-r*o,b=n*u-i*o,w=n*l-a*o,M=r*u-i*s,E=r*l-a*s,g=i*l-a*u,x=c*v-h*_,T=c*p-f*_,R=c*y-d*_,A=h*p-f*v,O=h*y-d*v,P=f*y-d*p,k=m*P-b*O+w*A+M*R-E*T+g*x;return k?(k=1/k,t[0]=(s*P-u*O+l*A)*k,t[1]=(i*O-r*P-a*A)*k,t[2]=(v*g-p*E+y*M)*k,t[3]=(f*E-h*g-d*M)*k,t[4]=(u*R-o*P-l*T)*k,t[5]=(n*P-i*R+a*T)*k,t[6]=(p*w-_*g-y*b)*k,t[7]=(c*g-f*w+d*b)*k,t[8]=(o*O-s*R+l*x)*k,t[9]=(r*R-n*O-a*x)*k,t[10]=(_*E-v*w+y*m)*k,t[11]=(h*w-c*E-d*m)*k,t[12]=(s*T-o*A-u*x)*k,t[13]=(n*A-r*T+i*x)*k,t[14]=(v*b-_*M-p*m)*k,t[15]=(c*M-h*b+f*m)*k,t):null}},{key:"mat4_multiply",value:function(t,e,n){var r=e[0],i=e[4],a=e[8],o=e[12],s=e[1],u=e[5],l=e[9],c=e[13],h=e[2],f=e[6],d=e[10],_=e[14],v=e[3],p=e[7],y=e[11],m=e[15],b=n[0],w=n[4],M=n[8],E=n[12],g=n[1],x=n[5],T=n[9],R=n[13],A=n[2],O=n[6],P=n[10],k=n[14],I=n[3],S=n[7],N=n[11],D=n[15];return t[0]=r*b+i*g+a*A+o*I,t[4]=r*w+i*x+a*O+o*S,t[8]=r*M+i*T+a*P+o*N,t[12]=r*E+i*R+a*k+o*D,t[1]=s*b+u*g+l*A+c*I,t[5]=s*w+u*x+l*O+c*S,t[9]=s*M+u*T+l*P+c*N,t[13]=s*E+u*R+l*k+c*D,t[2]=h*b+f*g+d*A+_*I,t[6]=h*w+f*x+d*O+_*S,t[10]=h*M+f*T+d*P+_*N,t[14]=h*E+f*R+d*k+_*D,t[3]=v*b+p*g+y*A+m*I,t[7]=v*w+p*x+y*O+m*S,t[11]=v*M+p*T+y*P+m*N,t[15]=v*E+p*R+y*k+m*D,t}}]),t}();e.default=s,s.PI_OVER_180=Math.PI/180},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;r(this,t),this.x=e,this.y=n,this.z=i,this.w=a}return i(t,[{key:"set",value:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z,this.w]}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}},{key:"setFromRotationMatrix",value:function(t){var e=t[0],n=t[4],r=t[8],i=t[1],a=t[5],o=t[9],s=t[2],u=t[6],l=t[10],c=e+a+l;if(c>0){var h=.5/Math.sqrt(c+1);this.w=.25/h,this.x=(u-o)*h,this.y=(r-s)*h,this.z=(i-n)*h}else if(e>a&&e>l){var f=2*Math.sqrt(1+e-a-l);this.w=(u-o)/f,this.x=.25*f,this.y=(n+i)/f,this.z=(r+s)/f}else if(a>l){var d=2*Math.sqrt(1+a-e-l);this.w=(r-s)/d,this.x=(n+i)/d,this.y=.25*d,this.z=(o+u)/d}else{var _=2*Math.sqrt(1+l-e-a);this.w=(i-n)/_,this.x=(r+s)/_,this.y=(o+u)/_,this.z=.25*_}return this}},{key:"setFromEuler",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"XYZ",i=Math.cos,a=Math.sin,o=i(t/2),s=i(e/2),u=i(n/2),l=a(t/2),c=a(e/2),h=a(n/2);"XYZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"YXZ"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"ZXY"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u-l*c*h):"ZYX"===r?(this.x=l*s*u-o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u+l*c*h):"YZX"===r?(this.x=l*s*u+o*c*h,this.y=o*c*u+l*s*h,this.z=o*s*h-l*c*u,this.w=o*s*u-l*c*h):"XZY"===r&&(this.x=l*s*u-o*c*h,this.y=o*c*u-l*s*h,this.z=o*s*h+l*c*u,this.w=o*s*u+l*c*h)}},{key:"setFromAxisAngle",value:function(t,e){var n=e/2,r=Math.sin(n);return this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(n),this}},{key:"multiply",value:function(t){return this.multiplyQuaternions(this,t)}},{key:"multiplyQuaternions",value:function(t,e){var n=t.x,r=t.y,i=t.z,a=t.w,o=e.x,s=e.y,u=e.z,l=e.w;return this.x=n*l+a*o+r*u-i*s,this.y=r*l+a*s+i*o-n*u,this.z=i*l+a*u+n*s-r*o,this.w=a*l-n*o-r*s-i*u,this}},{key:"inverse",value:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.normalize(),this}},{key:"normalize",value:function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===t?(this.x=0,this.y=0,this.z=0,this.w=1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this}},{key:"slerp",value:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this.x,r=this.y,i=this.z,a=this.w,o=a*t.w+n*t.x+r*t.y+i*t.z;if(o<0?(this.w=-t.w,this.x=-t.x,this.y=-t.y,this.z=-t.z,o=-o):this.copy(t),o>=1)return this.w=a,this.x=n,this.y=r,this.z=i,this;var s=Math.acos(o),u=Math.sqrt(1-o*o);if(Math.abs(u)<.001)return this.w=.5*(a+this.w),this.x=.5*(n+this.x),this.y=.5*(r+this.y),this.z=.5*(i+this.z),this;var l=Math.sin((1-e)*s)/u,c=Math.sin(e*s)/u;return this.w=a*l+this.w*c,this.x=n*l+this.x*c,this.y=r*l+this.y*c,this.z=i*l+this.z*c,this}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t),this._listeners=new Map}return i(t,[{key:"addEventListener",value:function(t,e){var n=this._listeners.get(t);!1===Array.isArray(n)&&(n=[],this._listeners.set(t,n)),n.push(e)}},{key:"removeEventListener",value:function(t,e){var n=this._listeners.get(t);if(!1!==Array.isArray(n))for(var r=0;r<n.length;r++)if(n[r]===e)return void n.splice(r,1)}},{key:"dispatchEvent",value:function(t){var e=this._listeners.get(t.type);if(!1!==Array.isArray(e)){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){(0,a.value)(t)}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}}}]),t}();e.default=a},function(t,e,n){function r(t){e.ARRAY_TYPE=s=t}function i(t){return t*u}function a(t,e){return Math.abs(t-e)<=o*Math.max(1,Math.abs(t),Math.abs(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.setMatrixArrayType=r,e.toRadian=i,e.equals=a;var o=e.EPSILON=1e-6,s=e.ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,u=(e.RANDOM=Math.random,Math.PI/180)},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e){r(this,t),this._uid=t._generateUID(),this._coordinateSystem=e}return i(t,[{key:"uid",get:function(){return this._uid}},{key:"coordinateSystem",get:function(){return this._coordinateSystem}}],[{key:"_generateUID",value:function(){return"anchor-"+(new Date).getTime()+"-"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}}]),t}();e.default=a},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(0),c=i(l),h=n(2),f=i(h),d=n(19),_=i(d),v=n(20),p=i(v),y=function(t){function e(t,n,r,i){a(this,e);var s=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));s._xr=t,s._displayName=n,s._isExternal=r,s._reality=i,s._headModelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.HEAD_MODEL),s._eyeLevelCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.EYE_LEVEL),s._trackerCoordinateSystem=new XRCoordinateSystem(s,XRCoordinateSystem.TRACKER),s._headPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._eyeLevelPose=new XRViewPose([0,XRViewPose.SITTING_EYE_HEIGHT,0]),s._trackerPoseModelMatrix=c.default.mat4_generateIdentity();return s._fov=new p.default(25,25,25,25),s._depthNear=.1,s._depthFar=1e3,s._views=[],s}return s(e,t),u(e,[{key:"supportsSession",value:function(t){return this._supportedCreationParameters(t)}},{key:"requestSession",value:function(t){var e=this;return new Promise(function(n,r){if(!1===e._supportedCreationParameters(t))return void r();t.type===XRSession.REALITY&&(e._reality=new _.default,e._xr._privateRealities.push(e._reality)),n(e._createSession(t))})}},{key:"_requestAnimationFrame",value:function(t){return window.requestAnimationFrame(t)}},{key:"_cancelAnimationFrame",value:function(t){return window.cancelAnimationFrame(t)}},{key:"_createSession",value:function(t){return new XRSession(this._xr,this,t)}},{key:"_supportedCreationParameters",value:function(t){throw"Should be implemented by extending class"}},{key:"_handleNewFrame",value:function(t){}},{key:"_handleAfterFrame",value:function(t){}},{key:"_handleNewBaseLayer",value:function(t){}},{key:"displayName",get:function(){return this._displayName}},{key:"isExternal",get:function(){return this._isExternal}}]),e}(f.default);e.default=y},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(2),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t,n,r,o){i(this,e);var s=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return s._xr=t,s._name=n,s._isShared=r,s._isPassthrough=o,s._anchors=new Map,s}return o(e,t),s(e,[{key:"getCoordinateSystem",value:function(){throw new Error("Not implemented")}},{key:"_start",value:function(){throw new Error("Exending classes should implement _start")}},{key:"_stop",value:function(){throw new Error("Exending classes should implement _stop")}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(t,e){throw new Error("Exending classes should implement _addAnchor")}},{key:"_findAnchor",value:function(t,e,n){throw new Error("Exending classes should implement _findAnchor")}},{key:"_findFloorAnchor",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=new Float32Array(t._headPose.poseModelMatrix);return new Promise(function(i,a){r[13]=0;var o=new XRCoordinateSystem(t,XRCoordinateSystem.TRACKER);o._relativeMatrix=r;var s=new XRAnchor(o,n);e._addAnchor(s,t),i(new XRAnchorOffset(s.uid))})}},{key:"_getAnchor",value:function(t){return this._anchors.get(t)||null}},{key:"_removeAnchor",value:function(t){throw new Error("Exending classes should implement _removeAnchor")}},{key:"_hitTestNoAnchor",value:function(t,e,n){throw new Error("Exending classes should implement _hitTestNoAnchor")}},{key:"_getLightAmbientIntensity",value:function(){throw new Error("Exending classes should implement _getLightAmbientIntensity")}},{key:"name",get:function(){return this._name}},{key:"isShared",get:function(){return this._isShared}},{key:"isPassthrough",get:function(){return this._isPassthrough}}]),e}(l.default);e.default=c},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(2),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t,n,r){i(this,e);var o=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return o._xr=t,o._display=n,o._createParameters=r,o._ended=!1,o._baseLayer=null,o._stageBounds=null,o}return o(e,t),s(e,[{key:"requestFrame",value:function(t){var e=this;if(this._ended)return null;if("function"!=typeof t)throw"Invalid callback";return this._display._requestAnimationFrame(function(){var n=e._createPresentationFrame();e._display._reality._handleNewFrame(n),e._display._handleNewFrame(n),t(n),e._display._handleAfterFrame(n)})}},{key:"cancelFrame",value:function(t){return this._display._cancelAnimationFrame(t)}},{key:"end",value:function(){if(!this._ended)return this._ended=!0,this._display._stop(),new Promise(function(t,e){t()})}},{key:"_createPresentationFrame",value:function(){return new XRPresentationFrame(this)}},{key:"_getCoordinateSystem",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){switch(o.value){case XRCoordinateSystem.HEAD_MODEL:return this._display._headModelCoordinateSystem;case XRCoordinateSystem.EYE_LEVEL:return this._display._eyeLevelCoordinateSystem;case XRCoordinateSystem.TRACKER:return this._display._trackerCoordinateSystem;case XRCoordinateSystem.GEOSPATIAL:default:continue}}}catch(t){i=!0,a=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw a}}return null}},{key:"display",get:function(){return this._display}},{key:"createParameters",get:function(){return this._parameters}},{key:"realities",get:function(){return this._xr._sharedRealities}},{key:"reality",get:function(){return this._display._reality}},{key:"baseLayer",get:function(){return this._baseLayer},set:function(t){this._baseLayer=t,this._display._handleNewBaseLayer(this._baseLayer)}},{key:"depthNear",get:function(){this._display._depthNear},set:function(t){this._display._depthNear=t}},{key:"depthFar",get:function(){this._display._depthFar},set:function(t){this._display._depthFar=t}},{key:"hasStageBounds",get:function(){this._stageBounds}},{key:"stageBounds",get:function(){return this._stageBounds}}]),e}(l.default);e.default=c,c.REALITY="reality",c.AUGMENTATION="augmentation",c.TYPES=[c.REALITY,c.AUGMENTATION]},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(14),s=r(o),u=n(0),l=r(u),c=function(){function t(e,n,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;i(this,t),this._fov=e,this._depthNear=n,this._depthFar=r,this._eye=a,this._viewport=new s.default(0,0,1,1),this._projectionMatrix=new Float32Array(16),this._viewMatrix=new Float32Array(16),l.default.mat4_perspectiveFromFieldOfView(this._projectionMatrix,this._fov,this._depthNear,this._depthFar)}return a(t,[{key:"setProjectionMatrix",value:function(t){for(var e=0;e<16;e++)this._projectionMatrix[e]=t[e]}},{key:"setViewMatrix",value:function(t){for(var e=0;e<16;e++)this._viewMatrix[e]=t[e]}},{key:"getViewport",value:function(e){return this._eye===t.LEFT?(this._viewport.x=0,this._viewport.y=0,this._viewport.width=e.framebufferWidth/2,this._viewport.height=e.framebufferHeight):this._eye===t.RIGHT?(this._viewport.x=e.framebufferWidth/2,this._viewport.y=0,this._viewport.width=e.framebufferWidth/2,this._viewport.height=e.framebufferHeight):(this._viewport.x=0,this._viewport.y=0,this._viewport.width=e.framebufferWidth,this._viewport.height=e.framebufferHeight),this._viewport}},{key:"eye",get:function(){return this._eye}},{key:"projectionMatrix",get:function(){return this._projectionMatrix}},{key:"viewMatrix",get:function(){return this._viewMatrix}}]),t}();e.default=c,c.LEFT="left",c.RIGHT="right",c.EYES=[c.LEFT,c.RIGHT]},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),s=r(o),u=n(1),l=r(u),c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0,1];i(this,t),this._poseModelMatrix=new Float32Array(16),s.default.mat4_fromRotationTranslation(this._poseModelMatrix,n,e)}return a(t,[{key:"_setPoseModelMatrix",value:function(t){for(var e=0;e<16;e++)this._poseModelMatrix[e]=t[e]}},{key:"_translate",value:function(t){this._poseModelMatrix[12]+=t[0],this._poseModelMatrix[13]+=t[1],this._poseModelMatrix[14]+=t[2]}},{key:"getViewMatrix",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return null===e&&(e=new Float32Array(16)),s.default.mat4_eyeView(e,this._poseModelMatrix),e}},{key:"poseModelMatrix",get:function(){return this._poseModelMatrix}},{key:"_position",get:function(){return[this._poseModelMatrix[12],this._poseModelMatrix[13],this._poseModelMatrix[14]]},set:function(t){this._poseModelMatrix[12]=t[0],this._poseModelMatrix[13]=t[1],this._poseModelMatrix[14]=t[2]}},{key:"_orientation",get:function(){var t=new l.default;return t.setFromRotationMatrix(this._poseModelMatrix),t.toArray()},set:function(t){s.default.mat4_fromRotationTranslation(this._poseModelMatrix,t,this._position)}}]),t}();e.default=c,c.SITTING_EYE_HEIGHT=1.1},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;r(this,t),this.x=e,this.y=n,this.z=i}return i(t,[{key:"set",value:function(t,e,n){return this.x=t,this.y=e,this.z=n,this}},{key:"copy",value:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"add",value:function(t,e,n){this.x+=t,this.y+=e,this.z+=n}},{key:"normalize",value:function(){var t=this.length();return 0!==t?this.multiplyScalar(1/t):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyScalar",value:function(t){this.x*=t,this.y*=t,this.z*=t}},{key:"applyQuaternion",value:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,a=t.y,o=t.z,s=t.w,u=s*e+a*r-o*n,l=s*n+o*e-i*r,c=s*r+i*n-a*e,h=-i*e-a*n-o*r;return this.x=u*s+h*-i+l*-o-c*-a,this.y=l*s+h*-a+c*-i-u*-o,this.z=c*s+h*-o+u*-a-l*-i,this}},{key:"applyMatrix4",value:function(t){var e=this.x,n=this.y,r=this.z,i=1/(t[3]*e+t[7]*n+t[11]*r+t[15]);return this.x=(t[0]*e+t[4]*n+t[8]*r+t[12])*i,this.y=(t[1]*e+t[5]*n+t[9]*r+t[13])*i,this.z=(t[2]*e+t[6]*n+t[10]*r+t[14])*i,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y+this.z*t.z}},{key:"crossVectors",value:function(t,e){var n=t.x,r=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}}]),t}();e.default=a},function(t,e,n){function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"===r(Symbol.iterator)?function(t){return void 0===t?"undefined":r(t)}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":void 0===t?"undefined":r(t)},l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(2),h=function(t){return t&&t.__esModule?t:{default:t}}(c),f=n(3),d=(i(f),n(31)),_=i(d),v=n(32),p=i(v),y=n(17),m=i(y),b=function(t){function e(){function t(){return this.modelMatrix=new Float32Array(16),this}a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));if(!1===e.HasARKit())throw"ARKitWrapper will only work in Mozilla's ARDemo test app";if(void 0!==e.GLOBAL_INSTANCE)throw"ARKitWrapper is a singleton. Use ARKitWrapper.GetOrCreate() to get the global instance.";n._deviceId=null,n._isWatching=!1,n._isInitialized=!1,n._rawARData=null,n.lightIntensity=1e3,n.projectionMatrix_=new Float32Array(16),n.viewMatrix_=new Float32Array(16),n.planes_=new Map,n.anchors_=new Map,n._globalCallbacksMap={};for(var r=["onInit","onWatch"],i=0;i<r.length;i++)n._generateGlobalCallback(r[i],i);for(var s=[["arkitStartRecording",e.RECORD_START_EVENT],["arkitStopRecording",e.RECORD_STOP_EVENT],["arkitDidMoveBackground",e.DID_MOVE_BACKGROUND_EVENT],["arkitWillEnterForeground",e.WILL_ENTER_FOREGROUND_EVENT],["arkitInterrupted",e.INTERRUPTED_EVENT],["arkitInterruptionEnded",e.INTERRUPTION_ENDED_EVENT],["arkitShowDebug",e.SHOW_DEBUG_EVENT],["arkitWindowResize",e.WINDOW_RESIZE_EVENT],["onError",e.ON_ERROR],["arTrackingChanged",e.AR_TRACKING_CHANGED]],u=0;u<s.length;u++)!function(t){window[s[t][0]]=function(e){e=e||null,n.dispatchEvent(new CustomEvent(s[t][1],{source:n,detail:e}))}}(u);var l=n;return n.getPlanes=function(){return Array.from(this.planes_.values())},n.hitTestNoAnchor=function(){var e={rayStart:m.create(),rayEnd:m.create(),cameraPosition:m.create(),cameraQuaternion:p.create(),modelViewMatrix:_.create(),projectionMatrix:_.create(),projViewMatrix:_.create(),worldRayStart:m.create(),worldRayEnd:m.create(),worldRayDir:m.create(),planeMatrix:_.create(),planeExtent:m.create(),planePosition:m.create(),planeCenter:m.create(),planeNormal:m.create(),planeIntersection:m.create(),planeIntersectionLocal:m.create(),planeHit:_.create()},n=function(t,e){_.set(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])},r=function(){var t=m.create();return function(e,n,r,i){var a=m.dot(e,i);return m.subtract(t,n,r),m.dot(t,e)/a}}(),i=function(t,r){n(e.planeMatrix,t.modelMatrix),_.getTranslation(e.planeIntersection,e.planeMatrix);var i=m.distance(e.planeIntersection,e.cameraPosition);return n(e.planeMatrix,r.modelMatrix),_.getTranslation(e.planeIntersection,e.planeMatrix),i<m.distance(e.planeIntersection,e.cameraPosition)?-1:1};return function(a,o){if(a<0||a>1||o<0||o>1)throw new Error("hitTest - x and y values must be normalized [0,1]!");var s=[],u=this.getPlanes();if(!u||0==u.length)return s;m.set(e.rayStart,2*a-1,2*(1-o)-1,0),m.set(e.rayEnd,2*a-1,2*(1-o)-1,1),n(e.projectionMatrix,l.projectionMatrix_),n(e.modelViewMatrix,l.viewMatrix_),_.multiply(e.projViewMatrix,e.projectionMatrix,e.modelViewMatrix),_.invert(e.projViewMatrix,e.projViewMatrix),m.transformMat4(e.worldRayStart,e.rayStart,e.projViewMatrix),m.transformMat4(e.worldRayEnd,e.rayEnd,e.projViewMatrix),m.subtract(e.worldRayDir,e.worldRayEnd,e.worldRayStart),m.normalize(e.worldRayDir,e.worldRayDir);for(var c=0;c<u.length;c++){var h=u[c];n(e.planeMatrix,h.modelMatrix),m.set(e.planeCenter,0,0,0),m.transformMat4(e.planePosition,e.planeCenter,e.planeMatrix),m.set(e.planeNormal,0,1,0);var f=r(e.planeNormal,e.planePosition,e.worldRayStart,e.worldRayDir);if(!(f<0)){m.scale(e.planeIntersection,e.worldRayDir,f),m.add(e.planeIntersection,e.worldRayStart,e.planeIntersection),m.set(e.planeExtent,h.extent[0],0,h.extent[1]),_.invert(e.planeMatrix,e.planeMatrix),m.transformMat4(e.planeIntersectionLocal,e.planeIntersection,e.planeMatrix);if(!(Math.abs(e.planeIntersectionLocal[0])>e.planeExtent[0]/2+.0075||Math.abs(e.planeIntersectionLocal[2])>e.planeExtent[2]/2+.0075)){_.fromTranslation(e.planeHit,e.planeIntersection);for(var d=new t,v=0;v<16;v++)d.modelMatrix[v]=e.planeHit[v];d.i=c,s.push(d)}}}return s.sort(i),s}}(),n}return s(e,t),l(e,[{key:"waitForInit",value:function(){var t=this;return new Promise(function(n,r){if(t._isInitialized)return void n();var i=function r(){t.removeEventListener(e.INIT_EVENT,r,!1),n()};t.addEventListener(e.INIT_EVENT,i,!1)})}},{key:"getData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===t?this._rawARData:this._rawARData&&void 0!==this._rawARData[t]?this._rawARData[t]:null}},{key:"getObject",value:function(t){if(!this._isInitialized)return null;var e=this.getKey("objects");if(null===e)return null;var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(s.uuid===t)return s}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}return null}},{key:"hitTest",value:function(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.HIT_TEST_TYPE_ALL;return new Promise(function(e,a){if(!r._isInitialized)return void a(new Error("ARKit is not initialized"));window.webkit.messageHandlers.hitTest.postMessage({x:t,y:n,type:i,callback:r._createPromiseCallback("hitTest",e)})})}},{key:"addAnchor",value:function(t,e){var n=this;return new Promise(function(r,i){if(!n._isInitialized)return void i(new Error("ARKit is not initialized"));window.webkit.messageHandlers.addAnchor.postMessage({uuid:t,transform:e,callback:n._createPromiseCallback("addAnchor",r)})})}},{key:"stop",value:function(){var t=this;return new Promise(function(e,n){if(!t._isWatching)return void e();window.webkit.messageHandlers.stopAR.postMessage({callback:t._createPromiseCallback("stop",e)})})}},{key:"watch",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(!this._isInitialized)return!1;if(this._isWatching)return!0;this._isWatching=!0,null===t&&(t={location:!0,camera:!0,objects:!0,light_intensity:!0});var e={options:t,callback:this._globalCallbacksMap.onWatch};return window.webkit.messageHandlers.watchAR.postMessage(e),!0}},{key:"setUIOptions",value:function(t){window.webkit.messageHandlers.setUIOptions.postMessage(t)}},{key:"_sendInit",value:function(t){window.webkit.messageHandlers.initAR.postMessage({options:t,callback:this._globalCallbacksMap.onInit})}},{key:"_onInit",value:function(t){this._deviceId=t,this._isInitialized=!0,this.dispatchEvent(new CustomEvent(e.INIT_EVENT,{source:this}))}},{key:"_onWatch",value:function(t){if(this._rawARData=t,this.dispatchEvent(new CustomEvent(e.WATCH_EVENT,{source:this,detail:this._rawARData})),this.lightIntensity=t.light_intensity,this.viewMatrix_=t.camera_view,this.projectionMatrix_=t.projection_camera,t.newObjects.length)for(var n=0;n<t.newObjects.length;n++){var r=t.newObjects[n];r.h_plane_center?this.planes_.set(r.uuid,{id:r.uuid,center:r.h_plane_center,extent:[r.h_plane_extent.x,r.h_plane_extent.z],modelMatrix:r.transform}):this.anchors_.set(r.uuid,{id:r.uuid,modelMatrix:r.transform})}if(t.removedObjects.length)for(var i=0;i<t.removedObjects.length;i++){var a=t.removedObjects[i];a.h_plane_center?this.planes_.delete(a.uuid):this.anchors_.delete(a.uuid)}if(t.objects.length)for(var o=0;o<t.objects.length;o++){var s=t.objects[o];if(s.h_plane_center){var u=this.planes_.get(s.uuid);u?(u.center=s.h_plane_center,u.extent=[s.h_plane_extent.x,s.h_plane_extent.z],u.transform=s.transform):this.planes_.set(s.uuid,{id:s.uuid,center:s.h_plane_center,extent:[s.h_plane_extent.x,s.h_plane_extent.z],transform:s.transform})}else{var l=this.anchors_.get(s.uuid);l?l.transform=s.transform:this.anchors_.set(s.uuid,{id:s.uuid,transform:s.transform})}}}},{key:"_onStop",value:function(){this._isWatching=!1}},{key:"_createPromiseCallback",value:function(t,e){var n=this,r=this._generateCallbackUID(t);return window[r]=function(i){delete window[r];var a="_on"+t[0].toUpperCase()+t.slice(1);"function"==typeof n[a]&&n[a](i),e(i)},r}},{key:"_generateCallbackUID",value:function(t){return"arkitCallback_"+t+"_"+(new Date).getTime()+"_"+Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}},{key:"_generateGlobalCallback",value:function(t,e){var n="arkitCallback"+e;this._globalCallbacksMap[t]=n;var r=this;window[n]=function(e){r["_"+t](e)}}},{key:"deviceId",get:function(){return this._deviceId}},{key:"isWatching",get:function(){return this._isWatching}},{key:"isInitialized",get:function(){return this._isInitialized}},{key:"hasData",get:function(){return null!==this._rawARData}}],[{key:"GetOrCreate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(void 0===e.GLOBAL_INSTANCE){e.GLOBAL_INSTANCE=new e,t=t&&"object"==(void 0===t?"undefined":u(t))?t:{};var n={browser:!0,points:!0,focus:!1,rec:!0,rec_time:!0,mic:!1,build:!1,plane:!0,warnings:!0,anchors:!1,debug:!0,statistics:!1},r="object"==u(t.ui)?t.ui:{};t.ui=Object.assign(n,r),e.GLOBAL_INSTANCE._sendInit(t)}return e.GLOBAL_INSTANCE}},{key:"HasARKit",value:function(){return void 0!==window.webkit}}]),e}(h.default);e.default=b,b.INIT_EVENT="arkit-init",b.WATCH_EVENT="arkit-watch",b.RECORD_START_EVENT="arkit-record-start",b.RECORD_STOP_EVENT="arkit-record-stop",b.DID_MOVE_BACKGROUND_EVENT="arkit-did-move-background",b.WILL_ENTER_FOREGROUND_EVENT="arkit-will-enter-foreground",b.INTERRUPTED_EVENT="arkit-interrupted",b.INTERRUPTION_ENDED_EVENT="arkit-interruption-ended",b.SHOW_DEBUG_EVENT="arkit-show-debug",b.WINDOW_RESIZE_EVENT="arkit-window-resize",b.ON_ERROR="on-error",b.AR_TRACKING_CHANGED="ar_tracking_changed",b.HIT_TEST_TYPE_FEATURE_POINT=1,b.HIT_TEST_TYPE_EXISTING_PLANE=8,b.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE=2,b.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT=16,b.HIT_TEST_TYPE_ALL=b.HIT_TEST_TYPE_FEATURE_POINT|b.HIT_TEST_TYPE_EXISTING_PLANE|b.HIT_TEST_TYPE_ESTIMATED_HORIZONTAL_PLANE|b.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT,b.HIT_TEST_TYPE_EXISTING_PLANES=b.HIT_TEST_TYPE_EXISTING_PLANE|b.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t),this._ambientLightIntensity=1}return i(t,[{key:"getAmbientColorTemperature",value:function(){throw new Error("Not implemented")}},{key:"ambientIntensity",set:function(t){this._ambientLightIntensity=t/1e3},get:function(){return this._ambientLightIntensity}}]),t}();e.default=a},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(0),s=r(o),u=n(1),l=r(u),c=n(4),h=(r(c),function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i(this,t),this._anchorUID=e,this._poseMatrix=n||s.default.mat4_generateIdentity()}return a(t,[{key:"getOffsetTransform",value:function(t){return s.default.mat4_multiply(new Float32Array(16),this._poseMatrix,t._poseModelMatrix)}},{key:"anchorUID",get:function(){return this._anchorUID}},{key:"poseMatrix",get:function(){return this._poseMatrix},set:function(t){for(var e=0;e<16;e++)this._poseMatrix[e]=t[e]}},{key:"position",get:function(){return new Float32Array([this._poseMatrix[12],this._poseMatrix[13],this._poseMatrix[14]])}},{key:"orientation",get:function(){var t=new l.default;return t.setFromRotationMatrix(this._poseMatrix),t.toArray()}}]),t}());e.default=h},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n,i,a){r(this,t),this._x=e,this._y=n,this._width=i,this._height=a}return i(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t}},{key:"y",get:function(){return this._y},set:function(t){this._y=t}},{key:"width",get:function(){return this._width},set:function(t){this._width=t}},{key:"height",get:function(){return this._height},set:function(t){this._height=t}}]),t}();e.default=a},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),u=function(t){return t&&t.__esModule?t:{default:t}}(s),l=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(u.default);e.default=l},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(2),c=i(l),h=n(10),f=i(h),d=n(1),_=i(d),v=n(30),p=i(v),y=function(t){function e(){a(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._deviceOrientation=null,t._windowOrientation=0,window.addEventListener("orientationchange",function(){t._windowOrientation=window.orientation||0},!1),window.addEventListener("deviceorientation",function(n){t._deviceOrientation=n,t.dispatchEvent(new CustomEvent(e.ORIENTATION_UPDATE_EVENT,{deviceOrientation:t._deviceOrientation,windowOrientation:t._windowOrientation}))},!1),t}return s(e,t),u(e,[{key:"getOrientation",value:function(t){return null===this._deviceOrientation?(t.set(0,0,0,1),!1):(e.WORKING_EULER.set(this._deviceOrientation.beta*e.DEG_TO_RAD,this._deviceOrientation.alpha*e.DEG_TO_RAD,-1*this._deviceOrientation.gamma*e.DEG_TO_RAD,"YXZ"),t.setFromEuler(e.WORKING_EULER.x,e.WORKING_EULER.y,e.WORKING_EULER.z,e.WORKING_EULER.order),t.multiply(e.HALF_PI_AROUND_X),t.multiply(e.WORKING_QUATERNION.setFromAxisAngle(e.Z_AXIS,-this._windowOrientation*e.DEG_TO_RAD)),!0)}}]),e}(c.default);e.default=y,y.ORIENTATION_UPDATE_EVENT="orientation-update",y.Z_AXIS=new f.default(0,0,1),y.WORKING_EULER=new p.default,y.WORKING_QUATERNION=new _.default,y.HALF_PI_AROUND_X=new _.default(-Math.sqrt(.5),0,0,Math.sqrt(.5)),y.DEG_TO_RAD=Math.PI/180},function(t,e,n){function r(){var t=new z.ARRAY_TYPE(3);return t[0]=0,t[1]=0,t[2]=0,t}function i(t){var e=new z.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function a(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function o(t,e,n){var r=new z.ARRAY_TYPE(3);return r[0]=t,r[1]=e,r[2]=n,r}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function u(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function h(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function f(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function d(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function _(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function v(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function p(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function y(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function m(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function b(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function w(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.sqrt(n*n+r*r+i*i)}function M(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function E(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function g(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function x(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function T(t,e){var n=e[0],r=e[1],i=e[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function A(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2];return t[0]=i*u-a*s,t[1]=a*o-r*u,t[2]=r*s-i*o,t}function O(t,e,n,r){var i=e[0],a=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t}function P(t,e,n,r,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),c=o*(3-2*a);return t[0]=e[0]*s+n[0]*u+r[0]*l+i[0]*c,t[1]=e[1]*s+n[1]*u+r[1]*l+i[1]*c,t[2]=e[2]*s+n[2]*u+r[2]*l+i[2]*c,t}function k(t,e,n,r,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,c=3*a*s,h=3*u*o,f=u*a;return t[0]=e[0]*l+n[0]*c+r[0]*h+i[0]*f,t[1]=e[1]*l+n[1]*c+r[1]*h+i[1]*f,t[2]=e[2]*l+n[2]*c+r[2]*h+i[2]*f,t}function I(t,e){e=e||1;var n=2*z.RANDOM()*Math.PI,r=2*z.RANDOM()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function S(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[3]*r+n[7]*i+n[11]*a+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*a+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*a+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*a+n[14])/o,t}function N(t,e,n){var r=e[0],i=e[1],a=e[2];return t[0]=r*n[0]+i*n[3]+a*n[6],t[1]=r*n[1]+i*n[4]+a*n[7],t[2]=r*n[2]+i*n[5]+a*n[8],t}function D(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,f=l*a+o*i-s*r,d=-o*r-s*i-u*a;return t[0]=c*l+d*-o+h*-u-f*-s,t[1]=h*l+d*-s+f*-o-c*-u,t[2]=f*l+d*-u+c*-s-h*-o,t}function C(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0],a[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),a[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function L(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),a[1]=i[1],a[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function j(t,e,n,r){var i=[],a=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],a[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),a[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),a[2]=i[2],t[0]=a[0]+n[0],t[1]=a[1]+n[1],t[2]=a[2]+n[2],t}function F(t,e){var n=o(t[0],t[1],t[2]),r=o(e[0],e[1],e[2]);T(n,n),T(r,r);var i=R(n,r);return i>1?0:i<-1?Math.PI:Math.acos(i)}function W(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function V(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function X(t,e){var n=t[0],r=t[1],i=t[2],a=e[0],o=e[1],s=e[2];return Math.abs(n-a)<=z.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=z.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(i-s)<=z.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=r,e.clone=i,e.length=a,e.fromValues=o,e.copy=s,e.set=u,e.add=l,e.subtract=c,e.multiply=h,e.divide=f,e.ceil=d,e.floor=_,e.min=v,e.max=p,e.round=y,e.scale=m,e.scaleAndAdd=b,e.distance=w,e.squaredDistance=M,e.squaredLength=E,e.negate=g,e.inverse=x,e.normalize=T,e.dot=R,e.cross=A,e.lerp=O,e.hermite=P,e.bezier=k,e.random=I,e.transformMat4=S,e.transformMat3=N,e.transformQuat=D,e.rotateX=C,e.rotateY=L,e.rotateZ=j,e.angle=F,e.str=W,e.exactEquals=V,e.equals=X;var H=n(3),z=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(H);e.sub=c,e.mul=h,e.div=f,e.dist=w,e.sqrDist=M,e.len=a,e.sqrLen=E,e.forEach=function(){var t=r();return function(e,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}()},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(5),c=i(l),h=n(7),f=i(h),d=n(21),_=i(d),v=n(6),p=i(v),y=n(22),m=i(y),b=n(12),w=i(b),M=n(4),E=i(M),g=n(23),x=i(g),T=n(13),R=i(T),A=n(24),O=i(A),P=n(25),k=i(P),I=n(26),S=i(I),N=n(8),D=i(N),C=n(14),L=i(C),j=n(27),F=i(j),W=n(9),V=i(W),X=n(15),H=i(X),z=n(28),Y=i(z),G=n(2),U=i(G),q=n(29),K=i(q),B=n(35),Z=i(B),Q=n(36),J=i(Q),$=function(t){function e(){a(this,e);var t=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));window.XRDisplay=c.default,window.XRSession=f.default,window.XRSessionCreateParameters=_.default,window.Reality=p.default,window.XRPointCloud=m.default,window.XRLightEstimate=w.default,window.XRAnchor=E.default,window.XRPlaneAnchor=x.default,window.XRAnchorOffset=R.default,window.XRStageBounds=O.default,window.XRStageBoundsPoint=k.default,window.XRPresentationFrame=S.default,window.XRView=D.default,window.XRViewport=L.default,window.XRCoordinateSystem=F.default,window.XRViewPose=V.default,window.XRLayer=H.default,window.XRWebGLLayer=Y.default,t._getVRDisplaysFinished=!1,t._sharedRealities=[new J.default(t)],t._privateRealities=[],t._displays=[new K.default(t,t._sharedRealities[0])],"function"==typeof navigator.getVRDisplays?navigator.getVRDisplays().then(function(e){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;null!==s&&(s.capabilities.canPresent&&t._displays.push(new Z.default(t,t._sharedRealities[0],s)))}}catch(t){r=!0,i=t}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}t._getVRDisplaysFinished=!0}):t._getVRDisplaysFinished=!0,t._sessionEls=document.createElement("div"),t._sessionEls.setAttribute("class","webxr-sessions"),t._realityEls=document.createElement("div"),t._realityEls.setAttribute("class","webxr-realities");for(var n=[t._sessionEls,t._realityEls],r=0;r<n.length;r++){var i=n[r];i.style.position="absolute",i.style.width="100%",i.style.height="100%"}return document.addEventListener("DOMContentLoaded",function(){document.body.style.width="100%",document.body.style.height="100%",document.body.prepend(t._sessionEls),document.body.prepend(t._realityEls)}),t}return s(e,t),u(e,[{key:"getDisplays",value:function(){var t=this,e=function e(n){t._getVRDisplaysFinished?n(t._displays):setTimeout(e.bind(t,n),30)};return new Promise(function(t,n){e(t)})}}]),e}(U.default);void 0===navigator.XR&&(navigator.XR=new $)},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(6),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"Virtual",!1,!1))}return o(e,t),s(e,[{key:"_start",value:function(){}},{key:"_stop",value:function(){}},{key:"_handleNewFrame",value:function(){}},{key:"_addAnchor",value:function(t,e){return this._anchors.set(t.uid,t),t.uid}},{key:"_findAnchor",value:function(t,e,n){return new Promise(function(t,e){t(null)})}},{key:"_removeAnchor",value:function(t){this._anchors.delete(t)}},{key:"_hitTestNoAnchor",value:function(t,e,n){return null}},{key:"_getHasLightEstimate",value:function(){return!1}}]),e}(l.default);e.default=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n,i,a){r(this,t),this._upDegrees=e,this._downDegrees=n,this._leftDegrees=i,this._rightDegrees=a}return i(t,[{key:"upDegrees",get:function(){return this._upDegrees}},{key:"downDegrees",get:function(){return this._downDegrees}},{key:"leftDegrees",get:function(){return this._leftDegrees}},{key:"rightDegrees",get:function(){return this._rightDegrees}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"exclusive",get:function(){throw"Not implemented"}},{key:"type",get:function(){throw"Not implemented"}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"points",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(4),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(){return i(this,e),a(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),s(e,[{key:"width",get:function(){throw"Not implemented"}},{key:"length",get:function(){throw"Not implemented"}}]),e}(l.default);e.default=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"center",get:function(){throw new Error("Not implemented")}},{key:"geometry",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(){r(this,t)}return i(t,[{key:"x",get:function(){throw new Error("Not implemented")}},{key:"y",get:function(){throw new Error("Not implemented")}}]),t}();e.default=a},function(t,e,n){function r(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=n(4),s=r(o),u=n(0),l=r(u),c=function(){function t(e){i(this,t),this._session=e}return a(t,[{key:"addAnchor",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0,0],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[0,0,0,1],r=l.default.mat4_fromRotationTranslation(new Float32Array(16),n,e);l.default.mat4_multiply(r,t.getTransformTo(this._session._display._trackerCoordinateSystem),r);var i=new XRCoordinateSystem(this._session._display,XRCoordinateSystem.TRACKER);return i._relativeMatrix=r,this._session.reality._addAnchor(new s.default(i),this._session.display)}},{key:"findAnchor",value:function(t,e){return this._session.reality._findAnchor(t,e,this._session.display)}},{key:"hitTestNoAnchor",value:function(t,e){return this._session.reality._hitTestNoAnchor(t,e,this._session.display)}},{key:"findFloorAnchor",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return this._session.reality._findFloorAnchor(this._session.display,t)}},{key:"removeAnchor",value:function(t){return this._session.reality._removeAnchor(t)}},{key:"getAnchor",value:function(t){return this._session.reality._getAnchor(t)}},{key:"getCoordinateSystem",value:function(){var t;return(t=this._session)._getCoordinateSystem.apply(t,arguments)}},{key:"getDisplayPose",value:function(t){switch(t._type){case XRCoordinateSystem.HEAD_MODEL:return this._session._display._headPose;case XRCoordinateSystem.EYE_LEVEL:return this._session._display._eyeLevelPose;default:return null}}},{key:"session",get:function(){return this._session}},{key:"views",get:function(){return this._session._display._views}},{key:"hasPointCloud",get:function(){return!1}},{key:"pointCloud",get:function(){return null}},{key:"hasLightEstimate",get:function(){return this._session.reality._getHasLightEstimate()}},{key:"lightEstimate",get:function(){return this._session.reality._getLightAmbientIntensity()}},{key:"anchors",get:function(){var t=[],e=!0,n=!1,r=void 0;try{for(var i,a=this._session.reality._anchors.values()[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;t.push(o)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}return t}}]),t}();e.default=c},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n(0),o=function(t){return t&&t.__esModule?t:{default:t}}(a),s=function(){function t(e,n){r(this,t),this._display=e,this._type=n,this.__relativeMatrix=o.default.mat4_generateIdentity(),this._workingMatrix=o.default.mat4_generateIdentity()}return i(t,[{key:"getTransformTo",value:function(t){var e=o.default.mat4_invert(new Float32Array(16),t._poseModelMatrix),n=o.default.mat4_generateIdentity();return o.default.mat4_multiply(n,e,n),o.default.mat4_multiply(n,this._poseModelMatrix,n),n}},{key:"_relativeMatrix",get:function(){return this.__relativeMatrix},set:function(t){for(var e=0;e<16;e++)this.__relativeMatrix[e]=t[e]}},{key:"_poseModelMatrix",get:function(){switch(this._type){case t.HEAD_MODEL:return this._display._headPose.poseModelMatrix;case t.EYE_LEVEL:return this._display._eyeLevelPose.poseModelMatrix;case t.TRACKER:return o.default.mat4_multiply(this._workingMatrix,this.__relativeMatrix,this._display._trackerPoseModelMatrix),this._workingMatrix;default:throw new Error("Unknown coordinate system type: "+this._type)}}}]),t}();e.default=s,s.HEAD_MODEL="headModel",s.EYE_LEVEL="eyeLevel",s.TRACKER="tracker",s.TYPES=[s.HEAD_MODEL,s.EYE_LEVEL,s.TRACKER]},function(t,e,n){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=n(15),l=function(t){return t&&t.__esModule?t:{default:t}}(u),c=function(t){function e(t,n){i(this,e);var r=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return r._session=t,r._context=n,r._width=r._context.canvas.width,r._height=r._context.canvas.height,r._framebuffer=null,r}return o(e,t),s(e,[{key:"requestViewportScaling",value:function(t){throw"Not implemented"}},{key:"context",get:function(){return this._context}},{key:"antialias",get:function(){throw"Not implemented"}},{key:"depth",get:function(){throw"Not implemented"}},{key:"stencil",get:function(){throw"Not implemented"}},{key:"alpha",get:function(){throw"Not implemented"}},{key:"multiview",get:function(){throw"Not implemented"}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"framebufferWidth",set:function(t){this._width=t,this._context.canvas.width=t},get:function(){return this._width}},{key:"framebufferHeight",set:function(t){this._height=t,this._context.canvas.height=t},get:function(){return this._height}}]),e}(l.default);e.default=c},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=function t(e,n,r){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var a=Object.getPrototypeOf(e);return null===a?void 0:t(a,n,r)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(r)},h=n(5),f=i(h),d=n(8),_=i(d),v=n(7),p=i(v),y=n(0),m=i(y),b=n(1),w=i(b),M=n(10),E=i(M),g=n(16),x=i(g),T=n(11),R=i(T),A=function(t){function e(t,n){o(this,e);var r=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"Flat",!1,n));return r._started=!1,r._initialized=!1,r._arKitWrapper=null,r._vrFrameData=null,r._deviceOrientationTracker=null,r._deviceOrientation=null,r._devicePosition=null,r._deviceWorldMatrix=null,r._views.push(new _.default(r._fov,r._depthNear,r._depthFar)),r}return u(e,t),l(e,[{key:"_start",value:function(){var t=this;this._reality._vrDisplay?null===this._vrFrameData&&(this._vrFrameData=new VRFrameData,this._views[0]._depthNear=this._reality._vrDisplay.depthNear,this._views[0]._depthFar=this._reality._vrDisplay.depthFar,this._deviceOrientation=new w.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16)):R.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=R.default.GetOrCreate(),this._arKitWrapper.addEventListener(R.default.INIT_EVENT,this._handleARKitInit.bind(this)),this._arKitWrapper.addEventListener(R.default.WATCH_EVENT,this._handleARKitUpdate.bind(this)),this._arKitWrapper.addEventListener(R.default.WINDOW_RESIZE_EVENT,this._handleARKitWindowResize.bind(this)),this._arKitWrapper.addEventListener(R.default.ON_ERROR,this._handleOnError.bind(this)),this._arKitWrapper.addEventListener(R.default.AR_TRACKING_CHANGED,this._handleArTrackingChanged.bind(this)),this._arKitWrapper.waitForInit().then(function(){t._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized&&(this._initialized=!0,this._deviceOrientation=new w.default,this._devicePosition=new E.default,this._deviceWorldMatrix=new Float32Array(16),this._deviceOrientationTracker=new x.default,this._deviceOrientationTracker.addEventListener(x.default.ORIENTATION_UPDATE_EVENT,this._updateFromDeviceOrientationTracker.bind(this))),this.running=!0,this._reality._start()}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewBaseLayer",value:function(t){this.baseLayer=t,t._context.canvas.style.width="100%",t._context.canvas.style.height="100%",t.framebufferWidth=this._xr._sessionEls.clientWidth,t.framebufferHeight=this._xr._sessionEls.clientHeight,null===this._arKitWrapper&&window.addEventListener("resize",function(){t.framebufferWidth=t._context.canvas.clientWidth,t.framebufferHeight=t._context.canvas.clientHeight},!1),this._xr._sessionEls.appendChild(t._context.canvas)}},{key:"_handleNewFrame",value:function(t){null!==this._vrFrameData&&this._updateFromVRDevice()}},{key:"_updateFromVRDevice",value:function(){var t,e;this._reality._vrDisplay.getFrameData(this._vrFrameData),this._views[0].setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),(t=this._deviceOrientation).set.apply(t,a(this._vrFrameData.pose.orientation)),(e=this._devicePosition).set.apply(e,a(this._vrFrameData.pose.position)),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_updateFromDeviceOrientationTracker",value:function(){this._deviceOrientationTracker.getOrientation(this._deviceOrientation),this._devicePosition.set(this._headPose.poseModelMatrix[12],this._headPose.poseModelMatrix[13],this._headPose.poseModelMatrix[14]),this._devicePosition.add(0,XRViewPose.SITTING_EYE_HEIGHT,0),m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose._position=this._devicePosition.toArray()}},{key:"_handleARKitUpdate",value:function(){var t=this._arKitWrapper.getData("camera_transform");t?(this._headPose._setPoseModelMatrix(t),this._headPose._poseModelMatrix[13]+=XRViewPose.SITTING_EYE_HEIGHT,this._eyeLevelPose._position=this._headPose._position):console.log("no camera transform",this._arKitWrapper.rawARData);var e=this._arKitWrapper.getData("projection_camera");e?this._views[0].setProjectionMatrix(e):console.log("no projection camera",this._arKitWrapper.rawARData)}},{key:"_handleARKitInit",value:function(t){var e=this;setTimeout(function(){e._arKitWrapper.watch({location:!0,camera:!0,objects:!0,light_intensity:!0})},1e3)}},{key:"_handleARKitWindowResize",value:function(t){this.baseLayer.framebufferWidth=t.detail.width,this.baseLayer.framebufferHeight=t.detail.height}},{key:"_handleOnError",value:function(t){}},{key:"_handleArTrackingChanged",value:function(t){}},{key:"_createSession",value:function(t){return this._start(),c(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"_createSession",this).call(this,t)}},{key:"_supportedCreationParameters",value:function(t){return t.type===p.default.AUGMENTATION&&!1===t.exclusive}}]),e}(f.default);e.default=A},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=function(){function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;r(this,t),this.x=e,this.y=n,this.z=i,this.order=a}return i(t,[{key:"set",value:function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;this.x=e,this.y=n,this.z=r,this.order=i}},{key:"toArray",value:function(){return[this.x,this.y,this.z]}}]),t}();e.default=a,a.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],a.DefaultOrder="XYZ"},function(t,e,n){function r(){var t=new K.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function i(t){var e=new K.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function o(t,e,n,r,i,a,o,s,u,l,c,h,f,d,_,v){var p=new K.ARRAY_TYPE(16);return p[0]=t,p[1]=e,p[2]=n,p[3]=r,p[4]=i,p[5]=a,p[6]=o,p[7]=s,p[8]=u,p[9]=l,p[10]=c,p[11]=h,p[12]=f,p[13]=d,p[14]=_,p[15]=v,p}function s(t,e,n,r,i,a,o,s,u,l,c,h,f,d,_,v,p){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t[9]=c,t[10]=h,t[11]=f,t[12]=d,t[13]=_,t[14]=v,t[15]=p,t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function l(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function c(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],p=e[14],y=e[15],m=n*s-r*o,b=n*u-i*o,w=n*l-a*o,M=r*u-i*s,E=r*l-a*s,g=i*l-a*u,x=c*v-h*_,T=c*p-f*_,R=c*y-d*_,A=h*p-f*v,O=h*y-d*v,P=f*y-d*p,k=m*P-b*O+w*A+M*R-E*T+g*x;return k?(k=1/k,t[0]=(s*P-u*O+l*A)*k,t[1]=(i*O-r*P-a*A)*k,t[2]=(v*g-p*E+y*M)*k,t[3]=(f*E-h*g-d*M)*k,t[4]=(u*R-o*P-l*T)*k,t[5]=(n*P-i*R+a*T)*k,t[6]=(p*w-_*g-y*b)*k,t[7]=(c*g-f*w+d*b)*k,t[8]=(o*O-s*R+l*x)*k,t[9]=(r*R-n*O-a*x)*k,t[10]=(_*E-v*w+y*m)*k,t[11]=(h*w-c*E-d*m)*k,t[12]=(s*T-o*A-u*x)*k,t[13]=(n*A-r*T+i*x)*k,t[14]=(v*b-_*M-p*m)*k,t[15]=(c*M-h*b+f*m)*k,t):null}function h(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],p=e[14],y=e[15];return t[0]=s*(f*y-d*p)-h*(u*y-l*p)+v*(u*d-l*f),t[1]=-(r*(f*y-d*p)-h*(i*y-a*p)+v*(i*d-a*f)),t[2]=r*(u*y-l*p)-s*(i*y-a*p)+v*(i*l-a*u),t[3]=-(r*(u*d-l*f)-s*(i*d-a*f)+h*(i*l-a*u)),t[4]=-(o*(f*y-d*p)-c*(u*y-l*p)+_*(u*d-l*f)),t[5]=n*(f*y-d*p)-c*(i*y-a*p)+_*(i*d-a*f),t[6]=-(n*(u*y-l*p)-o*(i*y-a*p)+_*(i*l-a*u)),t[7]=n*(u*d-l*f)-o*(i*d-a*f)+c*(i*l-a*u),t[8]=o*(h*y-d*v)-c*(s*y-l*v)+_*(s*d-l*h),t[9]=-(n*(h*y-d*v)-c*(r*y-a*v)+_*(r*d-a*h)),t[10]=n*(s*y-l*v)-o*(r*y-a*v)+_*(r*l-a*s),t[11]=-(n*(s*d-l*h)-o*(r*d-a*h)+c*(r*l-a*s)),t[12]=-(o*(h*p-f*v)-c*(s*p-u*v)+_*(s*f-u*h)),t[13]=n*(h*p-f*v)-c*(r*p-i*v)+_*(r*f-i*h),t[14]=-(n*(s*p-u*v)-o*(r*p-i*v)+_*(r*u-i*s)),t[15]=n*(s*f-u*h)-o*(r*f-i*h)+c*(r*u-i*s),t}function f(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11],d=t[12],_=t[13],v=t[14],p=t[15];return(e*o-n*a)*(h*p-f*v)-(e*s-r*a)*(c*p-f*_)+(e*u-i*a)*(c*v-h*_)+(n*s-r*o)*(l*p-f*d)-(n*u-i*o)*(l*v-h*d)+(r*u-i*s)*(l*_-c*d)}function d(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=e[9],d=e[10],_=e[11],v=e[12],p=e[13],y=e[14],m=e[15],b=n[0],w=n[1],M=n[2],E=n[3];return t[0]=b*r+w*s+M*h+E*v,t[1]=b*i+w*u+M*f+E*p,t[2]=b*a+w*l+M*d+E*y,t[3]=b*o+w*c+M*_+E*m,b=n[4],w=n[5],M=n[6],E=n[7],t[4]=b*r+w*s+M*h+E*v,t[5]=b*i+w*u+M*f+E*p,t[6]=b*a+w*l+M*d+E*y,t[7]=b*o+w*c+M*_+E*m,b=n[8],w=n[9],M=n[10],E=n[11],t[8]=b*r+w*s+M*h+E*v,t[9]=b*i+w*u+M*f+E*p,t[10]=b*a+w*l+M*d+E*y,t[11]=b*o+w*c+M*_+E*m,b=n[12],w=n[13],M=n[14],E=n[15],t[12]=b*r+w*s+M*h+E*v,t[13]=b*i+w*u+M*f+E*p,t[14]=b*a+w*l+M*d+E*y,t[15]=b*o+w*c+M*_+E*m,t}function _(t,e,n){var r=n[0],i=n[1],a=n[2],o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*a+e[12],t[13]=e[1]*r+e[5]*i+e[9]*a+e[13],t[14]=e[2]*r+e[6]*i+e[10]*a+e[14],t[15]=e[3]*r+e[7]*i+e[11]*a+e[15]):(o=e[0],s=e[1],u=e[2],l=e[3],c=e[4],h=e[5],f=e[6],d=e[7],_=e[8],v=e[9],p=e[10],y=e[11],t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=c,t[5]=h,t[6]=f,t[7]=d,t[8]=_,t[9]=v,t[10]=p,t[11]=y,t[12]=o*r+c*i+_*a+e[12],t[13]=s*r+h*i+v*a+e[13],t[14]=u*r+f*i+p*a+e[14],t[15]=l*r+d*i+y*a+e[15]),t}function v(t,e,n){var r=n[0],i=n[1],a=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function p(t,e,n,r){var i=r[0],a=r[1],o=r[2],s=Math.sqrt(i*i+a*a+o*o),u=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=void 0,p=void 0,y=void 0,m=void 0,b=void 0,w=void 0,M=void 0,E=void 0,g=void 0,x=void 0,T=void 0,R=void 0,A=void 0,O=void 0,P=void 0,k=void 0,I=void 0;return Math.abs(s)<K.EPSILON?null:(s=1/s,i*=s,a*=s,o*=s,u=Math.sin(n),l=Math.cos(n),c=1-l,h=e[0],f=e[1],d=e[2],_=e[3],v=e[4],p=e[5],y=e[6],m=e[7],b=e[8],w=e[9],M=e[10],E=e[11],g=i*i*c+l,x=a*i*c+o*u,T=o*i*c-a*u,R=i*a*c-o*u,A=a*a*c+l,O=o*a*c+i*u,P=i*o*c+a*u,k=a*o*c-i*u,I=o*o*c+l,t[0]=h*g+v*x+b*T,t[1]=f*g+p*x+w*T,t[2]=d*g+y*x+M*T,t[3]=_*g+m*x+E*T,t[4]=h*R+v*A+b*O,t[5]=f*R+p*A+w*O,t[6]=d*R+y*A+M*O,t[7]=_*R+m*A+E*O,t[8]=h*P+v*k+b*I,t[9]=f*P+p*k+w*I,t[10]=d*P+y*k+M*I,t[11]=_*P+m*k+E*I,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function y(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*r,t[5]=o*i+c*r,t[6]=s*i+h*r,t[7]=u*i+f*r,t[8]=l*i-a*r,t[9]=c*i-o*r,t[10]=h*i-s*r,t[11]=f*i-u*r,t}function m(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],c=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*r,t[1]=o*i-c*r,t[2]=s*i-h*r,t[3]=u*i-f*r,t[8]=a*r+l*i,t[9]=o*r+c*i,t[10]=s*r+h*i,t[11]=u*r+f*i,t}function b(t,e,n){var r=Math.sin(n),i=Math.cos(n),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],c=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*r,t[1]=o*i+c*r,t[2]=s*i+h*r,t[3]=u*i+f*r,t[4]=l*i-a*r,t[5]=c*i-o*r,t[6]=h*i-s*r,t[7]=f*i-u*r,t}function w(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function M(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function E(t,e,n){var r=n[0],i=n[1],a=n[2],o=Math.sqrt(r*r+i*i+a*a),s=void 0,u=void 0,l=void 0;return Math.abs(o)<K.EPSILON?null:(o=1/o,r*=o,i*=o,a*=o,s=Math.sin(e),u=Math.cos(e),l=1-u,t[0]=r*r*l+u,t[1]=i*r*l+a*s,t[2]=a*r*l-i*s,t[3]=0,t[4]=r*i*l-a*s,t[5]=i*i*l+u,t[6]=a*i*l+r*s,t[7]=0,t[8]=r*a*l+i*s,t[9]=i*a*l-r*s,t[10]=a*a*l+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function g(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function x(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=r+r,u=i+i,l=a+a,c=r*s,h=r*u,f=r*l,d=i*u,_=i*l,v=a*l,p=o*s,y=o*u,m=o*l;return t[0]=1-(d+v),t[1]=h+m,t[2]=f-y,t[3]=0,t[4]=h-m,t[5]=1-(c+v),t[6]=_+p,t[7]=0,t[8]=f+y,t[9]=_-p,t[10]=1-(c+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function A(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function O(t,e){var n=e[0],r=e[1],i=e[2],a=e[4],o=e[5],s=e[6],u=e[8],l=e[9],c=e[10];return t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(a*a+o*o+s*s),t[2]=Math.sqrt(u*u+l*l+c*c),t}function P(t,e){var n=e[0]+e[5]+e[10],r=0;return n>0?(r=2*Math.sqrt(n+1),t[3]=.25*r,t[0]=(e[6]-e[9])/r,t[1]=(e[8]-e[2])/r,t[2]=(e[1]-e[4])/r):e[0]>e[5]&e[0]>e[10]?(r=2*Math.sqrt(1+e[0]-e[5]-e[10]),t[3]=(e[6]-e[9])/r,t[0]=.25*r,t[1]=(e[1]+e[4])/r,t[2]=(e[8]+e[2])/r):e[5]>e[10]?(r=2*Math.sqrt(1+e[5]-e[0]-e[10]),t[3]=(e[8]-e[2])/r,t[0]=(e[1]+e[4])/r,t[1]=.25*r,t[2]=(e[6]+e[9])/r):(r=2*Math.sqrt(1+e[10]-e[0]-e[5]),t[3]=(e[1]-e[4])/r,t[0]=(e[8]+e[2])/r,t[1]=(e[6]+e[9])/r,t[2]=.25*r),t}function k(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],u=i+i,l=a+a,c=o+o,h=i*u,f=i*l,d=i*c,_=a*l,v=a*c,p=o*c,y=s*u,m=s*l,b=s*c,w=r[0],M=r[1],E=r[2];return t[0]=(1-(_+p))*w,t[1]=(f+b)*w,t[2]=(d-m)*w,t[3]=0,t[4]=(f-b)*M,t[5]=(1-(h+p))*M,t[6]=(v+y)*M,t[7]=0,t[8]=(d+m)*E,t[9]=(v-y)*E,t[10]=(1-(h+_))*E,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function I(t,e,n,r,i){var a=e[0],o=e[1],s=e[2],u=e[3],l=a+a,c=o+o,h=s+s,f=a*l,d=a*c,_=a*h,v=o*c,p=o*h,y=s*h,m=u*l,b=u*c,w=u*h,M=r[0],E=r[1],g=r[2],x=i[0],T=i[1],R=i[2];return t[0]=(1-(v+y))*M,t[1]=(d+w)*M,t[2]=(_-b)*M,t[3]=0,t[4]=(d-w)*E,t[5]=(1-(f+y))*E,t[6]=(p+m)*E,t[7]=0,t[8]=(_+b)*g,t[9]=(p-m)*g,t[10]=(1-(f+v))*g,t[11]=0,t[12]=n[0]+x-(t[0]*x+t[4]*T+t[8]*R),t[13]=n[1]+T-(t[1]*x+t[5]*T+t[9]*R),t[14]=n[2]+R-(t[2]*x+t[6]*T+t[10]*R),t[15]=1,t}function S(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,d=i*s,_=i*u,v=a*o,p=a*s,y=a*u;return t[0]=1-h-_,t[1]=c+y,t[2]=f-p,t[3]=0,t[4]=c-y,t[5]=1-l-_,t[6]=d+v,t[7]=0,t[8]=f+p,t[9]=d-v,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function N(t,e,n,r,i,a,o){var s=1/(n-e),u=1/(i-r),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t}function D(t,e,n,r,i){var a=1/Math.tan(e/2),o=1/(r-i);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(i+r)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*i*r*o,t[15]=0,t}function C(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(i-a)*l*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function L(t,e,n,r,i,a,o){var s=1/(e-n),u=1/(r-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(o+a)*l,t[15]=1,t}function j(t,e,n,r){var i=void 0,a=void 0,o=void 0,s=void 0,l=void 0,c=void 0,h=void 0,f=void 0,d=void 0,_=void 0,v=e[0],p=e[1],y=e[2],m=r[0],b=r[1],w=r[2],M=n[0],E=n[1],g=n[2];return Math.abs(v-M)<K.EPSILON&&Math.abs(p-E)<K.EPSILON&&Math.abs(y-g)<K.EPSILON?u(t):(h=v-M,f=p-E,d=y-g,_=1/Math.sqrt(h*h+f*f+d*d),h*=_,f*=_,d*=_,i=b*d-w*f,a=w*h-m*d,o=m*f-b*h,_=Math.sqrt(i*i+a*a+o*o),_?(_=1/_,i*=_,a*=_,o*=_):(i=0,a=0,o=0),s=f*o-d*a,l=d*i-h*o,c=h*a-f*i,_=Math.sqrt(s*s+l*l+c*c),_?(_=1/_,s*=_,l*=_,c*=_):(s=0,l=0,c=0),t[0]=i,t[1]=s,t[2]=h,t[3]=0,t[4]=a,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=c,t[10]=d,t[11]=0,t[12]=-(i*v+a*p+o*y),t[13]=-(s*v+l*p+c*y),t[14]=-(h*v+f*p+d*y),t[15]=1,t)}function F(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=r[0],u=r[1],l=r[2],c=i-n[0],h=a-n[1],f=o-n[2],d=c*c+h*h+f*f;d>0&&(d=1/Math.sqrt(d),c*=d,h*=d,f*=d);var _=u*f-l*h,v=l*c-s*f,p=s*h-u*c;return t[0]=_,t[1]=v,t[2]=p,t[3]=0,t[4]=h*p-f*v,t[5]=f*_-c*p,t[6]=c*v-h*_,t[7]=0,t[8]=c,t[9]=h,t[10]=f,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t}function W(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function V(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))}function X(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function H(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function z(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Y(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function G(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function U(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],d=t[11],_=t[12],v=t[13],p=t[14],y=t[15],m=e[0],b=e[1],w=e[2],M=e[3],E=e[4],g=e[5],x=e[6],T=e[7],R=e[8],A=e[9],O=e[10],P=e[11],k=e[12],I=e[13],S=e[14],N=e[15];return Math.abs(n-m)<=K.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(r-b)<=K.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(i-w)<=K.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(a-M)<=K.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-E)<=K.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-g)<=K.EPSILON*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(u-x)<=K.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(l-T)<=K.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-R)<=K.EPSILON*Math.max(1,Math.abs(c),Math.abs(R))&&Math.abs(h-A)<=K.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(f-O)<=K.EPSILON*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(d-P)<=K.EPSILON*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(_-k)<=K.EPSILON*Math.max(1,Math.abs(_),Math.abs(k))&&Math.abs(v-I)<=K.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(p-S)<=K.EPSILON*Math.max(1,Math.abs(p),Math.abs(S))&&Math.abs(y-N)<=K.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))}Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=r,e.clone=i,e.copy=a,e.fromValues=o,e.set=s,e.identity=u,e.transpose=l,e.invert=c,e.adjoint=h,e.determinant=f,e.multiply=d,e.translate=_,e.scale=v,e.rotate=p,e.rotateX=y,e.rotateY=m,e.rotateZ=b,e.fromTranslation=w,e.fromScaling=M,e.fromRotation=E,e.fromXRotation=g,e.fromYRotation=x,e.fromZRotation=T,e.fromRotationTranslation=R,e.getTranslation=A,e.getScaling=O,e.getRotation=P,e.fromRotationTranslationScale=k,e.fromRotationTranslationScaleOrigin=I,e.fromQuat=S,e.frustum=N,e.perspective=D,e.perspectiveFromFieldOfView=C,e.ortho=L,e.lookAt=j,e.targetTo=F,e.str=W,e.frob=V,e.add=X,e.subtract=H,e.multiplyScalar=z,e.multiplyScalarAndAdd=Y,e.exactEquals=G,e.equals=U;var q=n(3),K=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(q);e.mul=d,e.sub=H},function(t,e,n){function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}function i(){var t=new w.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function a(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function o(t,e,n){n*=.5;var r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function s(t,e){var n=2*Math.acos(e[3]),r=Math.sin(n/2);return 0!=r?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=1,t[1]=0,t[2]=0),n}function u(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=n[0],u=n[1],l=n[2],c=n[3];return t[0]=r*c+o*s+i*l-a*u,t[1]=i*c+o*u+a*s-r*l,t[2]=a*c+o*l+r*u-i*s,t[3]=o*c-r*s-i*u-a*l,t}function l(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-r*s,t}function c(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u-a*s,t[1]=i*u+o*s,t[2]=a*u+r*s,t[3]=o*u-i*s,t}function h(t,e,n){n*=.5;var r=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*s,t[1]=i*u-r*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function f(t,e){var n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function d(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3],u=n[0],l=n[1],c=n[2],h=n[3],f=void 0,d=void 0,_=void 0,v=void 0,p=void 0;return d=i*u+a*l+o*c+s*h,d<0&&(d=-d,u=-u,l=-l,c=-c,h=-h),1-d>1e-6?(f=Math.acos(d),_=Math.sin(f),v=Math.sin((1-r)*f)/_,p=Math.sin(r*f)/_):(v=1-r,p=r),t[0]=v*i+p*u,t[1]=v*a+p*l,t[2]=v*o+p*c,t[3]=v*s+p*h,t}function _(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a,s=o?1/o:0;return t[0]=-n*s,t[1]=-r*s,t[2]=-i*s,t[3]=a*s,t}function v(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function p(t,e){var n=e[0]+e[4]+e[8],r=void 0;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}function y(t,e,n,r){var i=.5*Math.PI/180;e*=i,n*=i,r*=i;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(n),u=Math.cos(n),l=Math.sin(r),c=Math.cos(r);return t[0]=a*u*c-o*s*l,t[1]=o*s*c+a*u*l,t[2]=o*u*l-a*s*c,t[3]=o*u*c+a*s*l,t}function m(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}Object.defineProperty(e,"__esModule",{value:!0}),e.setAxes=e.sqlerp=e.rotationTo=e.equals=e.exactEquals=e.normalize=e.sqrLen=e.squaredLength=e.len=e.length=e.lerp=e.dot=e.scale=e.mul=e.add=e.set=e.copy=e.fromValues=e.clone=void 0,e.create=i,e.identity=a,e.setAxisAngle=o,e.getAxisAngle=s,e.multiply=u,e.rotateX=l,e.rotateY=c,e.rotateZ=h,e.calculateW=f,e.slerp=d,e.invert=_,e.conjugate=v,e.fromMat3=p,e.fromEuler=y,e.str=m;var b=n(3),w=r(b),M=n(33),E=r(M),g=n(17),x=r(g),T=n(34),R=r(T),A=(e.clone=R.clone,e.fromValues=R.fromValues,e.copy=R.copy,e.set=R.set,e.add=R.add,e.mul=u,e.scale=R.scale,e.dot=R.dot,e.lerp=R.lerp,e.length=R.length),O=(e.len=A,e.squaredLength=R.squaredLength),P=(e.sqrLen=O,e.normalize=R.normalize);e.exactEquals=R.exactEquals,e.equals=R.equals,e.rotationTo=function(){var t=x.create(),e=x.fromValues(1,0,0),n=x.fromValues(0,1,0);return function(r,i,a){var s=x.dot(i,a);return s<-.999999?(x.cross(t,e,i),x.len(t)<1e-6&&x.cross(t,n,i),x.normalize(t,t),o(r,t,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(x.cross(t,i,a),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+s,P(r,r))}}(),e.sqlerp=function(){var t=i(),e=i();return function(n,r,i,a,o,s){return d(t,r,o,s),d(e,i,a,s),d(n,t,e,2*s*(1-s)),n}}(),e.setAxes=function(){var t=E.create();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],P(e,p(e,t))}}()},function(t,e,n){function r(){var t=new D.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function a(t){var e=new D.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function s(t,e,n,r,i,a,o,s,u){var l=new D.ARRAY_TYPE(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=r,l[4]=i,l[5]=a,l[6]=o,l[7]=s,l[8]=u,l}function u(t,e,n,r,i,a,o,s,u,l){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function c(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function h(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*o-s*l,f=-c*a+s*u,d=l*a-o*u,_=n*h+r*f+i*d;return _?(_=1/_,t[0]=h*_,t[1]=(-c*r+i*l)*_,t[2]=(s*r-i*o)*_,t[3]=f*_,t[4]=(c*n-i*u)*_,t[5]=(-s*n+i*a)*_,t[6]=d*_,t[7]=(-l*n+r*u)*_,t[8]=(o*n-r*a)*_,t):null}function f(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t[0]=o*c-s*l,t[1]=i*l-r*c,t[2]=r*s-i*o,t[3]=s*u-a*c,t[4]=n*c-i*u,t[5]=i*a-n*s,t[6]=a*l-o*u,t[7]=r*u-n*l,t[8]=n*o-r*a,t}function d(t){var e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+n*(-l*i+o*s)+r*(u*i-a*s)}function _(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=n[0],d=n[1],_=n[2],v=n[3],p=n[4],y=n[5],m=n[6],b=n[7],w=n[8];return t[0]=f*r+d*o+_*l,t[1]=f*i+d*s+_*c,t[2]=f*a+d*u+_*h,t[3]=v*r+p*o+y*l,t[4]=v*i+p*s+y*c,t[5]=v*a+p*u+y*h,t[6]=m*r+b*o+w*l,t[7]=m*i+b*s+w*c,t[8]=m*a+b*u+w*h,t}function v(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=n[0],d=n[1];return t[0]=r,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=f*r+d*o+l,t[7]=f*i+d*s+c,t[8]=f*a+d*u+h,t}function p(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],c=e[7],h=e[8],f=Math.sin(n),d=Math.cos(n);return t[0]=d*r+f*o,t[1]=d*i+f*s,t[2]=d*a+f*u,t[3]=d*o-f*r,t[4]=d*s-f*i,t[5]=d*u-f*a,t[6]=l,t[7]=c,t[8]=h,t}function y(t,e,n){var r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function m(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function b(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function w(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function M(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function E(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n+n,s=r+r,u=i+i,l=n*o,c=r*o,h=r*s,f=i*o,d=i*s,_=i*u,v=a*o,p=a*s,y=a*u;return t[0]=1-h-_,t[3]=c-y,t[6]=f+p,t[1]=c+y,t[4]=1-l-_,t[7]=d-v,t[2]=f-p,t[5]=d+v,t[8]=1-l-h,t}function g(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],p=e[14],y=e[15],m=n*s-r*o,b=n*u-i*o,w=n*l-a*o,M=r*u-i*s,E=r*l-a*s,g=i*l-a*u,x=c*v-h*_,T=c*p-f*_,R=c*y-d*_,A=h*p-f*v,O=h*y-d*v,P=f*y-d*p,k=m*P-b*O+w*A+M*R-E*T+g*x;return k?(k=1/k,t[0]=(s*P-u*O+l*A)*k,t[1]=(u*R-o*P-l*T)*k,t[2]=(o*O-s*R+l*x)*k,t[3]=(i*O-r*P-a*A)*k,t[4]=(n*P-i*R+a*T)*k,t[5]=(r*R-n*O-a*x)*k,t[6]=(v*g-p*E+y*M)*k,t[7]=(p*w-_*g-y*b)*k,t[8]=(_*E-v*w+y*m)*k,t):null}function x(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function T(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function R(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))}function A(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function O(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function P(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function k(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t}function I(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function S(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=e[0],f=e[1],d=e[2],_=e[3],v=e[4],p=e[5],y=e[6],m=e[7],b=e[8];return Math.abs(n-h)<=D.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(r-f)<=D.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(i-d)<=D.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(a-_)<=D.EPSILON*Math.max(1,Math.abs(a),Math.abs(_))&&Math.abs(o-v)<=D.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-p)<=D.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-y)<=D.EPSILON*Math.max(1,Math.abs(u),Math.abs(y))&&Math.abs(l-m)<=D.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-b)<=D.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))}Object.defineProperty(e,"__esModule",{value:!0}),e.sub=e.mul=void 0,e.create=r,e.fromMat4=i,e.clone=a,e.copy=o,e.fromValues=s,e.set=u,e.identity=l,e.transpose=c,e.invert=h,e.adjoint=f,e.determinant=d,e.multiply=_,e.translate=v,e.rotate=p,e.scale=y,e.fromTranslation=m,e.fromRotation=b,e.fromScaling=w,e.fromMat2d=M,e.fromQuat=E,e.normalFromMat4=g,e.projection=x,e.str=T,e.frob=R,e.add=A,e.subtract=O,e.multiplyScalar=P,e.multiplyScalarAndAdd=k,e.exactEquals=I,e.equals=S;var N=n(3),D=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(N);e.mul=_,e.sub=O},function(t,e,n){function r(){var t=new C.ARRAY_TYPE(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function i(t){var e=new C.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(t,e,n,r){var i=new C.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function o(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function s(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function u(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function c(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function h(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function f(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function d(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function _(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function v(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function p(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function y(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function m(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t}function b(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.sqrt(n*n+r*r+i*i+a*a)}function w(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return n*n+r*r+i*i+a*a}function M(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function E(t){var e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function g(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function x(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function T(t,e){var n=e[0],r=e[1],i=e[2],a=e[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=a*o),t}function R(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function A(t,e,n,r){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+r*(n[0]-i),t[1]=a+r*(n[1]-a),t[2]=o+r*(n[2]-o),t[3]=s+r*(n[3]-s),t}function O(t,e){return e=e||1,t[0]=C.RANDOM(),t[1]=C.RANDOM(),t[2]=C.RANDOM(),t[3]=C.RANDOM(),T(t,t),y(t,t,e),t}function P(t,e,n){var r=e[0],i=e[1],a=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,t}function k(t,e,n){var r=e[0],i=e[1],a=e[2],o=n[0],s=n[1],u=n[2],l=n[3],c=l*r+s*a-u*i,h=l*i+u*r-o*a,f=l*a+o*i-s*r,d=-o*r-s*i-u*a;return t[0]=c*l+d*-o+h*-u-f*-s,t[1]=h*l+d*-s+f*-o-c*-u,t[2]=f*l+d*-u+c*-s-h*-o,t[3]=e[3],t}function I(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function S(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function N(t,e){var n=t[0],r=t[1],i=t[2],a=t[3],o=e[0],s=e[1],u=e[2],l=e[3];return Math.abs(n-o)<=C.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=C.EPSILON*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-u)<=C.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=C.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))}Object.defineProperty(e,"__esModule",{value:!0}),e.forEach=e.sqrLen=e.len=e.sqrDist=e.dist=e.div=e.mul=e.sub=void 0,e.create=r,e.clone=i,e.fromValues=a,e.copy=o,e.set=s,e.add=u,e.subtract=l,e.multiply=c,e.divide=h,e.ceil=f,e.floor=d,e.min=_,e.max=v,e.round=p,e.scale=y,e.scaleAndAdd=m,e.distance=b,e.squaredDistance=w,e.length=M,e.squaredLength=E,e.negate=g,e.inverse=x,e.normalize=T,e.dot=R,e.lerp=A,e.random=O,e.transformMat4=P,e.transformQuat=k,e.str=I,e.exactEquals=S,e.equals=N;var D=n(3),C=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(D);e.sub=l,e.mul=c,e.div=h,e.dist=b,e.sqrDist=w,e.len=M,e.sqrLen=E,e.forEach=function(){var t=r();return function(e,n,r,i,a,o){var s=void 0,u=void 0;for(n||(n=4),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}()},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),c=n(5),h=i(c),f=n(8),d=i(f),_=n(7),v=i(_),p=n(9),y=(i(p),n(0)),m=i(y),b=n(1),w=i(b),M=n(10),E=i(M),g=n(16),x=(i(g),n(11)),T=(i(x),function(t){function e(t,n,r){o(this,e);var i=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r.displayName,r.capabilities.hasExternalDisplay,n));return i._vrDisplay=r,i._vrFrameData=new VRFrameData,i._leftView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.LEFT),i._rightView=new d.default(i._fov,i._depthNear,i._depthFar,d.default.RIGHT),i._views=[i._leftView,i._rightView],i._deviceOrientation=new w.default,i._devicePosition=new E.default,i._deviceWorldMatrix=new Float32Array(16),i}return u(e,t),l(e,[{key:"_requestAnimationFrame",value:function(t){this._vrDisplay.isPresenting?this._vrDisplay.requestAnimationFrame(t):window.requestAnimationFrame(t)}},{key:"_handleNewBaseLayer",value:function(t){var e=this;this._vrDisplay.requestPresent([{source:t._context.canvas}]).then(function(){var n=e._vrDisplay.getEyeParameters("left"),r=e._vrDisplay.getEyeParameters("right");t.framebufferWidth=2*Math.max(n.renderWidth,r.renderWidth),t.framebufferHeight=Math.max(n.renderHeight,r.renderHeight),t._context.canvas.style.position="absolute",t._context.canvas.style.bottom="1px",t._context.canvas.style.right="1px",t._context.canvas.style.width="100%",t._context.canvas.style.height="100%",document.body.appendChild(t._context.canvas)}).catch(function(t){console.error("Unable to init WebVR 1.1 display",t)})}},{key:"_stop",value:function(){!1!==this.running&&(this.running=!1,this._reality._stop())}},{key:"_handleNewFrame",value:function(t){this._vrDisplay.isPresenting&&this._updateFromVRFrameData()}},{key:"_handleAfterFrame",value:function(t){this._vrDisplay.isPresenting&&this._vrDisplay.submitFrame()}},{key:"_supportedCreationParameters",value:function(t){return t.type===v.default.REALITY&&!0===t.exclusive}},{key:"_updateFromVRFrameData",value:function(){if(this._vrDisplay.getFrameData(this._vrFrameData),this._leftView.setViewMatrix(this._vrFrameData.leftViewMatrix),this._rightView.setViewMatrix(this._vrFrameData.rightViewMatrix),this._leftView.setProjectionMatrix(this._vrFrameData.leftProjectionMatrix),this._rightView.setProjectionMatrix(this._vrFrameData.rightProjectionMatrix),this._vrFrameData.pose){if(this._vrFrameData.pose.orientation){var t;(t=this._deviceOrientation).set.apply(t,a(this._vrFrameData.pose.orientation))}if(this._vrFrameData.pose.position){var e;(e=this._devicePosition).set.apply(e,a(this._vrFrameData.pose.position))}m.default.mat4_fromRotationTranslation(this._deviceWorldMatrix,this._deviceOrientation.toArray(),this._devicePosition.toArray()),this._vrDisplay.stageParameters&&this._vrDisplay.stageParameters.sittingToStandingTransform&&m.default.mat4_multiply(this._deviceWorldMatrix,this._vrDisplay.stageParameters.sittingToStandingTransform,this._deviceWorldMatrix),this._headPose._setPoseModelMatrix(this._deviceWorldMatrix),this._eyeLevelPose.position=this._devicePosition.toArray()}}}]),e}(h.default));e.default=T},function(t,e,n){function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==(void 0===e?"undefined":r(e))&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+(void 0===e?"undefined":r(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),l=n(6),c=i(l),h=n(4),f=i(h),d=n(9),_=i(d),v=n(13),p=i(v),y=n(12),m=i(y),b=n(0),w=i(b),M=n(1),E=i(M),g=n(11),x=i(g),T=n(37),R=i(T),A=function(t){function e(t){a(this,e);var n=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,"Camera",!0,!0));return n._initialized=!1,n._running=!1,n._arKitWrapper=null,n._mediaStream=null,n._videoEl=null,n._arCoreCameraRenderer=null,n._arCoreCanvas=null,n._elContext=null,n._vrDisplay=null,n._vrFrameData=null,n._lightEstimate=new m.default,"function"==typeof navigator.getVRDisplays&&navigator.getVRDisplays().then(function(t){var e=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var s=a.value;if(null!==s&&s.capabilities.hasPassThroughCamera){if(n._vrDisplay=s,n._vrFrameData=new VRFrameData,!window.WebARonARKitSetData&&(n._arCoreCanvas=document.createElement("canvas"),n._xr._realityEls.appendChild(n._arCoreCanvas),n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight,n._elContext=n._arCoreCanvas.getContext("webgl"),null===n._elContext))throw"Could not create CameraReality GL context";break}}}catch(t){r=!0,i=t}finally{try{!e&&o.return&&o.return()}finally{if(r)throw i}}}),window.addEventListener("resize",function(){n._arCoreCanvas&&(n._arCoreCanvas.width=window.innerWidth,n._arCoreCanvas.height=window.innerHeight)},!1),n}return s(e,t),u(e,[{key:"_handleNewFrame",value:function(t){this._vrDisplay&&(this._arCoreCameraRenderer&&this._arCoreCameraRenderer.render(),this._vrDisplay.getFrameData(this._vrFrameData))}},{key:"_start",value:function(){var t=this;this._running||(this._running=!0,null!==this._vrDisplay?(window.WebARonARKitSetData||(this._arCoreCameraRenderer=new R.default(this._vrDisplay,this._elContext)),this._initialized=!0):x.default.HasARKit()?!1===this._initialized?(this._initialized=!0,this._arKitWrapper=x.default.GetOrCreate(),this._arKitWrapper.addEventListener(x.default.WATCH_EVENT,this._handleARKitWatch.bind(this)),this._arKitWrapper.waitForInit().then(function(){t._arKitWrapper.watch()})):this._arKitWrapper.watch():!1===this._initialized?(this._initialized=!0,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(function(e){t._videoEl=document.createElement("video"),t._xr._realityEls.appendChild(t._videoEl),t._videoEl.setAttribute("class","camera-reality-video"),t._videoEl.setAttribute("playsinline",!0),t._videoEl.style.width="100%",t._videoEl.style.height="100%",t._videoEl.srcObject=e,t._videoEl.play()}).catch(function(e){console.error("Could not set up video stream",e),t._initialized=!1,t._running=!1})):(this._xr._realityEls.appendChild(this._videoEl),this._videoEl.play()))}},{key:"_stop",value:function(){if(!1!==this._running)if(this._running=!1,x.default.HasARKit()){if(null===this._arKitWrapper)return;this._arKitWrapper.stop()}else this._arCoreCanvas?(this._xr._realityEls.removeChild(this._arCoreCanvas),this._arCoreCanvas=null):null!==this._videoEl&&(this._videoEl.pause(),this._xr._realityEls.removeChild(this._videoEl))}},{key:"_handleARKitWatch",value:function(t){if(t.detail&&t.detail.objects){var e=!0,n=!1,r=void 0;try{for(var i,a=t.detail.objects[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;this._updateAnchorFromARKitUpdate(o.uuid,o)}}catch(t){n=!0,r=t}finally{try{!e&&a.return&&a.return()}finally{if(n)throw r}}}}},{key:"_handleARKitAddObject",value:function(t){this._updateAnchorFromARKitUpdate(t.uuid,t)}},{key:"_updateAnchorFromARKitUpdate",value:function(t,e){var n=this._anchors.get(t)||null;null!==n&&(n.coordinateSystem._relativeMatrix=e.transform)}},{key:"_addAnchor",value:function(t,e){var n=this;return null!==this._arKitWrapper&&this._arKitWrapper.addAnchor(t.uid,t.coordinateSystem._poseModelMatrix).then(function(t){return n._handleARKitAddObject(t)}),this._anchors.set(t.uid,t),t.uid}},{key:"_findAnchor",value:function(t,e,n){var r=this;return new Promise(function(i,a){if(null!==r._arKitWrapper)r._arKitWrapper.hitTest(t,e,x.default.HIT_TEST_TYPE_EXISTING_PLANES).then(function(t){if(0===t.length)return void i(null);var e=r._pickARKitHit(t);e.anchor_transform[13]+=_.default.SITTING_EYE_HEIGHT,e.world_transform[13]+=_.default.SITTING_EYE_HEIGHT;var a=r._getAnchor(e.uuid);if(null===a){var o=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);o._relativeMatrix=e.anchor_transform,a=new f.default(o,e.uuid),r._anchors.set(a.uid,a)}var s=[e.world_transform[12]-e.anchor_transform[12],e.world_transform[13]-e.anchor_transform[13],e.world_transform[14]-e.anchor_transform[14]],u=(new E.default).setFromRotationMatrix(e.world_transform),l=(new E.default).setFromRotationMatrix(e.anchor_transform).inverse(),c=(new E.default).multiplyQuaternions(u,l),h=new p.default(a.uid);h.poseMatrix=w.default.mat4_fromRotationTranslation(new Float32Array(16),c.toArray(),s),i(h)});else if(null!==r._vrDisplay){var o=r._vrDisplay.hitTest(t,e);if(0==o.length)return void i(null);o.sort(function(t,e){return t.distance-e.distance});var s=r._getAnchor(o[0].uuid);if(null===s){var u=new XRCoordinateSystem(n,XRCoordinateSystem.TRACKER);u._relativeMatrix=o[0].modelMatrix,u._relativeMatrix[13]+=_.default.SITTING_EYE_HEIGHT,s=new f.default(u),r._anchors.set(s.uid,s)}i(new p.default(s.uid))}else i(null)})}},{key:"_removeAnchor",value:function(t){this._anchors.delete(t)}},{key:"_pickARKitHit",value:function(t){if(0===t.length)return null;var e=null,n=t.filter(function(t){return t.type!=x.default.HIT_TEST_TYPE_FEATURE_POINT}),r=n.filter(function(t){return t.type==x.default.HIT_TEST_TYPE_EXISTING_PLANE_USING_EXTENT}),i=n.filter(function(t){return t.type==x.default.HIT_TEST_TYPE_EXISTING_PLANE});return r.length?(r=r.sort(function(t,e){return t.distance-e.distance}),e=r[0]):i.length?(i=i.sort(function(t,e){return t.distance-e.distance}),e=i[0]):n.length?(n=n.sort(function(t,e){return t.distance-e.distance}),e=n[0]):e=t[0],e}},{key:"_hitTestNoAnchor",value:function(t,e,n){if(null!==this._arKitWrapper){for(var r=this._arKitWrapper.hitTestNoAnchor(t,e),i=0;i<r.length;i++)r[i].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==r.length?null:r}if(null!==this._vrDisplay){for(var a=this._vrDisplay.hitTest(t,e),o=0;o<a.length;o++)a[o].modelMatrix[13]+=_.default.SITTING_EYE_HEIGHT;return 0==a.length?null:a}return null}},{key:"_getHasLightEstimate",value:function(){return null!==this._arKitWrapper}},{key:"_getLightAmbientIntensity",value:function(){return null!==this._arKitWrapper?(this._lightEstimate.ambientIntensity=this._arKitWrapper.lightIntensity,this._lightEstimate.ambientIntensity):null}}]),e}(c.default);e.default=A},function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e,n){if("fragment"==n)var r=t.createShader(t.FRAGMENT_SHADER);else{if("vertex"!=n)return null;var r=t.createShader(t.VERTEX_SHADER)}return t.shaderSource(r,e),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS)?r:(console.error(t.getShaderInfoLog(r)),null)}function a(t,e,n){var r=i(t,e,"vertex"),a=i(t,n,"fragment");if(!a)return null;var o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,a),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS)||console.error("Could not initialise arview shaders"),o}function o(t,e){var n=0;switch(e){case 90:n=1;break;case 180:n=2;break;case 270:n=3;break;default:n=0}var r=0;switch(t){case 90:r=1;break;case 180:r=2;break;case 270:r=3;break;default:r=0}var i=r-n;return i<0&&(i+=4),i%4}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u="#extension GL_OES_EGL_image_external : require\n\nprecision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform samplerExternalOES uSampler;\n\nvoid main(void) {\n  gl_FragColor = texture2D(uSampler, vTextureCoord);\n}",l="attribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n  gl_Position = vec4(aVertexPosition, 1.0);\n  vTextureCoord = aTextureCoord;\n}",c=function(){function t(e,n){r(this,t),this.vrDisplay=e,this.gl=n,this.passThroughCamera=e.getPassThroughCamera(),this.program=a(n,l,u),n.useProgram(this.program),this.vertexPositionAttribute=n.getAttribLocation(this.program,"aVertexPosition"),this.textureCoordAttribute=n.getAttribLocation(this.program,"aTextureCoord"),this.samplerUniform=n.getUniformLocation(this.program,"uSampler"),this.vertexPositionBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.vertexPositionBuffer);var i=[-1,1,0,-1,-1,0,1,1,0,1,-1,0],s=new Float32Array(i);n.bufferData(n.ARRAY_BUFFER,s,n.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=12,this.textureCoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.textureCoordBuffer);var c=null;if(this.vrDisplay){var h=this.passThroughCamera.width/this.passThroughCamera.textureWidth,f=this.passThroughCamera.height/this.passThroughCamera.textureHeight;c=[[0,0,0,f,h,0,h,f],[h,0,0,0,h,f,0,f],[h,f,h,0,0,f,0,0],[0,f,h,f,0,0,h,0]]}else c=[[0,0,0,1,1,0,1,1],[1,0,0,0,1,1,0,1],[1,1,1,0,0,1,0,0],[0,1,1,1,0,0,1,0]];this.f32TextureCoords=[];for(var d=0;d<c.length;d++)this.f32TextureCoords.push(new Float32Array(c[d]));this.combinedOrientation=o(screen.orientation.angle,this.passThroughCamera.orientation),n.bufferData(n.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],n.STATIC_DRAW),this.textureCoordBuffer.itemSize=2,this.textureCoordBuffer.numItems=8,n.bindBuffer(n.ARRAY_BUFFER,null),this.indexBuffer=n.createBuffer(),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var _=[0,1,2,2,1,3],v=new Uint16Array(_);return n.bufferData(n.ELEMENT_ARRAY_BUFFER,v,n.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=6,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),this.texture=n.createTexture(),n.useProgram(null),this.projectionMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.mvMatrix=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this}return s(t,[{key:"render",value:function(){var t=this.gl;t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.enableVertexAttribArray(this.vertexPositionAttribute),t.vertexAttribPointer(this.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.textureCoordBuffer);var e=o(screen.orientation.angle,this.passThroughCamera.orientation);e!==this.combinedOrientation&&(this.combinedOrientation=e,t.bufferData(t.ARRAY_BUFFER,this.f32TextureCoords[this.combinedOrientation],t.STATIC_DRAW)),t.enableVertexAttribArray(this.textureCoordAttribute),t.vertexAttribPointer(this.textureCoordAttribute,this.textureCoordBuffer.itemSize,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_EXTERNAL_OES,this.texture),t.texImage2D(t.TEXTURE_EXTERNAL_OES,0,t.RGB,t.RGB,t.UNSIGNED_BYTE,this.passThroughCamera),t.uniform1i(this.samplerUniform,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.drawElements(t.TRIANGLES,this.indexBuffer.numItems,t.UNSIGNED_SHORT,0),t.bindTexture(t.TEXTURE_EXTERNAL_OES,null),t.disableVertexAttribArray(this.vertexPositionAttribute),t.disableVertexAttribArray(this.textureCoordAttribute),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.useProgram(null)}}]),t}(),h=function(){function t(e,n){r(this,t),this.vrDisplay=e,this.gl=n,this.videoRenderer=new c(e,this.gl),this.width=window.innerWidth,this.height=window.innerHeight,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}return s(t,[{key:"onWindowResize",value:function(){this.width=window.innerWidth,this.height=window.innerHeight}},{key:"render",value:function(){var t=this.gl,e=1*this.width,n=1*this.height;t.viewportWidth!==e&&(t.viewportWidth=e),t.viewportHeight!==n&&(t.viewportHeight=n),this.gl.viewport(0,0,t.viewportWidth,t.viewportHeight),this.videoRenderer.render()}}]),t}();e.default=h}])}]);